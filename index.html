<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I-STYLE Êñ∞Â∫ó„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ - ÂÆåÂÖ®Áâà</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #007AFF;
            --secondary: #5856D6;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --background: #F5F5F7;
            --surface: #FFFFFF;
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --border: #D2D2D7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* „Éè„É≥„Éê„Éº„Ç¨„Éº„É°„Éã„É•„Éº */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 1001;
            background: var(--primary);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* „Çµ„Ç§„Éâ„Éê„Éº */
        .sidebar {
            width: 280px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 1000;
            position: relative;
        }

        .sidebar.active {
            transform: translateX(0) !important;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .store-selector {
            margin-top: 16px;
        }

        .store-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            background: var(--background);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .store-select:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--surface);
        }

        .nav-menu {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--text-primary);
        }

        .nav-item:hover {
            background: var(--background);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-item .icon {
            margin-right: 12px;
            font-size: 20px;
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: var(--background);
        }

        .content-header {
            background: var(--surface);
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.9);
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .content-header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .content-header p {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .content-body {
            padding: 16px;
        }

        /* „É™„Çµ„Ç§„Ç∂„Éº */
        .sidebar-resizer {
            position: absolute;
            right: 0;
            top: 0;
            width: 5px;
            height: 100%;
            cursor: ew-resize;
            background: transparent;
            z-index: 1001;
            transition: background 0.2s ease;
        }

        .sidebar-resizer:hover {
            background: var(--primary);
        }

        .header-resizer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            cursor: ns-resize;
            background: transparent;
            z-index: 101;
            transition: background 0.2s ease;
        }

        .header-resizer:hover {
            background: var(--primary);
        }

        /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* „Ç´„Éº„Éâ */
        .card {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* „Éú„Çø„É≥ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0051D5;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .btn-secondary {
            background: var(--background);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #E8E8ED;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Áµ±Ë®à„Ç´„Éº„Éâ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 24px;
            border-radius: 16px;
            color: white;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ÈöéÂ±§„Çø„Çπ„ÇØ„É™„Çπ„Éà */
        .hierarchical-task-list {
            margin-top: 20px;
        }

        .task-group {
            margin-bottom: 16px;
        }

        .parent-task {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(88, 86, 214, 0.15));
            border-left: 6px solid var(--primary);
            padding: 20px;
            margin-bottom: 8px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 18px;
        }

        .child-tasks {
            margin-left: 30px;
        }

        .task-item {
            background: var(--background);
            border-left: 4px solid var(--primary);
            padding: 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .task-item:hover {
            background: #E8E8ED;
            transform: translateX(4px);
        }

        .task-item.level-1 {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));
            border-left-width: 6px;
            font-weight: 700;
            font-size: 18px;
            padding: 20px;
        }

        .task-item.level-2 {
            margin-left: 30px;
            border-left-color: var(--secondary);
            font-weight: 600;
            font-size: 16px;
        }

        .task-item.level-3 {
            margin-left: 60px;
            border-left-color: var(--success);
        }

        .task-item.level-4 { margin-left: 90px; border-left-color: var(--warning); }
        .task-item.level-5 { margin-left: 120px; border-left-color: #FF2D55; }
        .task-item.level-6 { margin-left: 150px; border-left-color: #AF52DE; }
        .task-item.level-7 { margin-left: 180px; border-left-color: #FFD60A; }
        .task-item.level-8 { margin-left: 210px; border-left-color: #64D2FF; }
        .task-item.level-9 { margin-left: 240px; border-left-color: #30D158; }
        .task-item.level-10 { margin-left: 270px; border-left-color: #BF5AF2; }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 12px;
        }

        .task-name {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .task-meta {
            display: flex;
            gap: 12px;
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .task-assignee {
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
        }

        .task-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
        }

        .task-status.pending { background: #FEF5E7; color: #D68910; }
        .task-status.in-progress { background: #E3F2FD; color: #1976D2; }
        .task-status.completed { background: #E8F5E9; color: #388E3C; }

        .task-memo {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 8px;
            font-style: italic;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-edit, .btn-delete {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background: #E3F2FD;
            color: #1976D2;
        }

        .btn-delete {
            background: #FFEBEE;
            color: #C62828;
        }

        /* „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà */
        .gantt-container {
            background: var(--surface);
            border-radius: 16px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 120px);
            min-height: 400px;
        }

        .gantt-scroll-wrapper {
            overflow-x: auto;
            overflow-y: auto;
            flex: 1;
            position: relative;
        }

        .gantt-header-fixed {
            position: sticky;
            top: 0;
            background: var(--surface);
            z-index: 15;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 16px;
        }

        .gantt-timeline-wrapper {
            display: flex;
        }

        .gantt-task-names {
            width: 300px;
            flex-shrink: 0;
            position: sticky;
            left: 0;
            background: var(--surface);
            z-index: 40;
        }

        .gantt-timeline-container {
            flex: 1;
            min-width: 2000px;
        }

        .gantt-calendar-header {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 12px;
        }

        .gantt-year-header {
            display: flex;
            margin-bottom: 8px;
        }

        .gantt-year-block {
            flex: 0 0 auto;
            text-align: center;
            padding: 10px 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 700;
            font-size: 15px;
            border-radius: 8px;
            margin: 0 1px;
        }

        .gantt-month-header {
            display: flex;
            margin-bottom: 4px;
        }

        .gantt-month-block {
            flex: 0 0 auto;
            text-align: center;
            padding: 8px 6px;
            background: var(--background);
            font-weight: 600;
            font-size: 13px;
            border-radius: 6px;
            margin: 0 1px;
        }

        .gantt-day-header {
            display: flex;
        }

        .gantt-day-cell {
            flex: 0 0 30px;
            width: 30px;
            text-align: center;
            padding: 6px 2px;
            font-size: 10px;
            border-right: 1px solid var(--border);
            color: var(--text-secondary);
            line-height: 1.2;
        }

        .gantt-day-cell.weekend {
            background: rgba(255, 149, 0, 0.05);
        }

        .gantt-day-cell.today {
            background: rgba(0, 122, 255, 0.15);
            color: var(--primary);
            font-weight: 700;
        }

        .gantt-row {
            display: flex;
            align-items: stretch;
            border-bottom: 1px solid var(--border);
            min-height: 30px;
        }

        .gantt-task-info {
            padding: 4px 8px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            background: #FFFFFF !important;
            position: sticky;
            left: 0;
            z-index: 150;
            border-right: 2px solid var(--border);
        }

        .gantt-row.level-1 .gantt-task-info {
            font-weight: 700;
            background: #e8f0ff !important;
        }

        .gantt-row.level-2 .gantt-task-info {
            padding-left: 32px;
            font-weight: 600;
        }

        .gantt-row.level-3 .gantt-task-info {
            padding-left: 52px;
        }

        .gantt-timeline-row {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
        }

        .gantt-timeline-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
        }

        .gantt-day-bg {
            border-right: 1px solid rgba(0, 0, 0, 0.05);
        }

        .gantt-day-bg.weekend {
            background: rgba(255, 149, 0, 0.02);
        }

        .gantt-bar {
            position: absolute;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 8px;
            cursor: move;
            display: flex;
            align-items: center;
            padding: 0 12px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            user-select: none;
            transition: box-shadow 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 5;
            opacity: 1;
        }

        .gantt-bar:hover {
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.5);
            z-index: 20;
        }

        .gantt-bar.dragging {
            opacity: 0.8;
            z-index: 100;
        }

        .gantt-bar-resize-left,
        .gantt-bar-resize-right {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 10px;
            cursor: ew-resize;
            background: rgba(255, 255, 255, 0.3);
        }

        .gantt-bar-resize-left {
            left: 0;
            border-radius: 8px 0 0 8px;
        }

        .gantt-bar-resize-right {
            right: 0;
            border-radius: 0 8px 8px 0;
        }

        .gantt-today-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--danger);
            z-index: 20;
            pointer-events: none;
            box-shadow: 0 0 8px rgba(255, 59, 48, 0.5);
        }

        /* „Ç´„É¨„É≥„ÉÄ„Éº */
        .calendar-container {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            height: calc(100vh - 220px);
            display: flex;
            flex-direction: column;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-shrink: 0;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 8px;
            flex: 1;
            min-height: 0;
        }

        .calendar-day {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            position: relative;
            overflow: auto;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: rgba(0, 122, 255, 0.1);
            border-color: var(--primary);
            border-width: 2px;
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .calendar-task {
            font-size: 11px;
            padding: 2px 6px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            margin-bottom: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* „Çπ„Çø„ÉÉ„Éï„Ç∞„É™„ÉÉ„Éâ */
        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .staff-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .staff-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .staff-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--primary);
        }

        .staff-role {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .staff-info-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .staff-info-item .icon {
            color: var(--text-secondary);
            margin-right: 8px;
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .staff-note {
            margin-top: 16px;
            padding: 12px;
            background: var(--background);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* „Éï„Ç©„Éº„É†ÂÖ±ÈÄö */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            background: var(--background);
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--surface);
        }

        /* „É¢„Éº„ÉÄ„É´ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--surface);
            margin: 10% auto;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }

        /* „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: var(--background);
        }

        .login-card {
            background: var(--surface);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        .login-card h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .login-error {
            background: #FFEBEE;
            color: #C62828;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            font-size: 14px;
        }

        /* Ë®≠ÂÆöÁîªÈù¢ */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .settings-card {
            padding: 24px;
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        /* „Çø„Ç§„É†„É©„Ç§„É≥ */
        .timeline-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px 0;
        }

        .timeline-item {
            display: flex;
            position: relative;
            padding-left: 50px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-date {
            position: absolute;
            left: 0;
            top: 0;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .timeline-dot {
            position: absolute;
            left: 14px;
            top: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--surface);
            z-index: 10;
        }

        .timeline-content {
            background: var(--surface);
            border-radius: 12px;
            padding: 16px;
            flex: 1;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border-left: 4px solid var(--primary);
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .timeline-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 16px;
        }

        /* Âç∞Âà∑„Çπ„Çø„Ç§„É´ */
        @media print {
            body {
                background: white;
            }

            .sidebar,
            .content-header,
            .mobile-menu-btn,
            .mobile-overlay,
            .btn,
            .task-actions,
            .store-selector,
            .settings-grid {
                display: none !important;
            }

            .app-container,
            .main-content {
                display: block;
                height: auto !important;
                overflow: visible !important;
            }

            .content-body {
                padding: 0;
            }

            .card {
                box-shadow: none;
                border: 1px solid var(--border);
                margin-bottom: 12px;
                break-inside: avoid;
            }

            .gantt-container {
                max-height: none;
                min-height: auto;
                padding: 0;
                border: none;
            }

            .gantt-header-fixed {
                position: relative;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--border);
                margin-bottom: 8px;
                background: white;
            }

            .gantt-year-block, .gantt-month-block {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            .gantt-scroll-wrapper {
                overflow: visible !important;
                max-height: none !important;
                transform: none !important;
            }

            .gantt-task-info {
                position: relative;
                left: auto;
            }
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100%;
                transform: translateX(-100%);
                box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
            }

            .mobile-menu-btn {
                display: block;
            }

            .mobile-overlay.active {
                display: block;
            }

            .content-header {
                padding: 20px 16px;
                padding-top: 80px;
            }

            .content-header h1 {
                font-size: 24px;
            }

            .content-body {
                padding: 16px;
            }

            .gantt-task-names, .gantt-task-info {
                width: 150px;
            }

            .task-item.level-2 {
                margin-left: 20px;
            }

            .task-item.level-3 {
                margin-left: 40px;
            }

            .task-item.level-4 {
                margin-left: 60px;
            }

            .task-item.level-5 {
                margin-left: 80px;
            }

            .task-item.level-6 {
                margin-left: 100px;
            }

            .task-item.level-7 {
                margin-left: 120px;
            }
        }
    </style>
</head>

<body>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
    <div class="mobile-overlay" onclick="toggleSidebar()"></div>

    <div class="app-container">

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">üè™ I-STYLE</div>
                <div class="store-selector">
                    <select class="store-select" id="storeSelect" onchange="switchStore()">
                        <option value="default">Â∫óËàóÈÅ∏Êäû</option>
                    </select>
                </div>
                <div id="userInfo" style="margin-top: 16px; padding: 12px; background: #F5F5F7; border-radius: 10px; display: none;">
                    <div style="font-weight: 600; margin-bottom: 4px;" id="currentUserName"></div>
                    <div style="font-size: 12px; color: #86868B;" id="currentUserRole"></div>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" onclick="showTab('dashboard')">
                    <span class="icon">üìä</span> „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                </div>
                <div class="nav-item" onclick="showTab('gantt')">
                    <span class="icon">üìÖ</span> „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà
                </div>
                <div class="nav-item" onclick="showTab('calendar')">
                    <span class="icon">üóìÔ∏è</span> „Ç´„É¨„É≥„ÉÄ„Éº
                </div>
                <div class="nav-item" onclick="showTab('staff')">
                    <span class="icon">üë•</span> „Çπ„Çø„ÉÉ„Éï
                </div>
                <div class="nav-item" onclick="showTab('timeline')">
                    <span class="icon">‚è±Ô∏è</span> „Çø„Ç§„É†„É©„Ç§„É≥
                </div>
                <div class="nav-item" onclick="showTab('tasks')">
                    <span class="icon">üìã</span> „Çø„Çπ„ÇØÁÆ°ÁêÜ
                </div>
                <div class="nav-item" onclick="showTab('settings')">
                    <span class="icon">‚öôÔ∏è</span> Ë®≠ÂÆö
                </div>
            </nav>

            <div style="margin-top: auto; padding: 16px; border-top: 1px solid #D2D2D7;">
                <button onclick="logout()" id="logoutBtn" style="width: 100%; display: none;" class="btn btn-secondary">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
            </div>

            <div class="sidebar-resizer" id="sidebarResizer"></div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="content-header" id="contentHeader">
                <h1 id="headerTitle">üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h1>
                <p id="headerSubtitle">„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó - „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂÖ®‰ΩìÂÉè</p>
                <div class="header-resizer" id="headerResizer"></div>
            </div>

            <div class="content-body">

                <div id="dashboard" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalTasks">32</div>
                            <div class="stat-label">ÂÖ®„Çø„Çπ„ÇØÊï∞</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--success), #2ECC71);">
                            <div class="stat-value" id="completedTasks">5</div>
                            <div class="stat-label">ÂÆå‰∫Ü„Çø„Çπ„ÇØ</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--warning), #F39C12);">
                            <div class="stat-value" id="inProgressTasks">11</div>
                            <div class="stat-label">ÈÄ≤Ë°å‰∏≠„Çø„Çπ„ÇØ</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #FF6B6B, #E74C3C);">
                            <div class="stat-value" id="progressPercent">30%</div>
                            <div class="stat-label">ÈÄ≤ÊçóÁéá</div>
                        </div>
                    </div>

                    <div id="dashboardStats" class="card">
                        </div>

                </div>

                <div id="gantt" class="tab-content">
                    <div class="card-header">
                        <h2 class="card-title">„Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà</h2>
                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="zoomIn()">‚ûï Êã°Â§ß</button>
                            <button class="btn btn-secondary" onclick="zoomOut()">‚ûñ Á∏ÆÂ∞è</button>
                            <button class="btn btn-secondary" onclick="resetZoom()">„É™„Çª„ÉÉ„Éà</button>
                            <span id="zoomDisplay" style="align-self: center; font-weight: 600; font-size: 14px; color: var(--text-secondary);">100%</span>
                        </div>
                    </div>
                    <div class="gantt-container">
                        <div class="gantt-scroll-wrapper" id="ganttScrollWrapper">
                            <div class="gantt-timeline-wrapper" id="ganttTimelineWrapper">
                                <div class="gantt-task-names" id="ganttTaskNames">
                                    </div>
                                <div class="gantt-timeline-container" id="ganttChart">
                                    <div class="gantt-header-fixed" id="ganttHeaderFixed">
                                        </div>
                                    <div id="ganttRows">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="calendar" class="tab-content">
                    <div class="card">
                        <div class="calendar-header">
                            <h2 id="currentMonthYear"></h2>
                            <div class="calendar-nav btn-group">
                                <button class="btn btn-secondary" onclick="previousMonth()">‚óÄ</button>
                                <button class="btn btn-secondary" onclick="todayMonth()">‰ªäÊó•</button>
                                <button class="btn btn-secondary" onclick="nextMonth()">‚ñ∂</button>
                            </div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            </div>
                    </div>
                </div>

                <div id="staff" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">„Çπ„Çø„ÉÉ„Éï‰∏ÄË¶ß</h2>
                            <button class="btn btn-primary" onclick="openStaffModal()">‚ûï „Çπ„Çø„ÉÉ„ÉïËøΩÂä†</button>
                        </div>
                        <div class="staff-grid" id="staffList">
                            </div>
                    </div>
                </div>

                <div id="timeline" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">‰∏ªË¶Å„Çø„Çπ„ÇØ „Çø„Ç§„É†„É©„Ç§„É≥</h2>
                        <div class="timeline-container" id="timelineView">
                            </div>
                    </div>
                </div>

                <div id="tasks" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">„Çø„Çπ„ÇØËøΩÂä† / Á∑®ÈõÜ</h2>
                        </div>
                        <form onsubmit="addOrUpdateTask(event)" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <input type="hidden" id="taskIdToEdit">

                            <div class="form-group">
                                <label class="form-label">„É¨„Éô„É´</label>
                                <input type="number" id="taskLevel" class="form-input" min="1" max="10" value="1" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ë¶™„Çø„Çπ„ÇØÂêç (Level-1/2„ÅÆÂêçÁß∞)</label>
                                <input type="text" id="taskParent" class="form-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label">„Çø„Çπ„ÇØÂêç</label>
                                <input type="text" id="taskName" class="form-input" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">ÊãÖÂΩìËÄÖ</label>
                                <input type="text" id="taskAssignee" class="form-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label">„É°„É¢</label>
                                <input type="text" id="taskMemo" class="form-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label">ÈñãÂßãÊó•</label>
                                <input type="date" id="taskStart" class="form-input" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">ÁµÇ‰∫ÜÊó•</label>
                                <input type="date" id="taskEnd" class="form-input" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                                <select id="taskStatus" class="form-input" required>
                                    <option value="pending">Êú™ÁùÄÊâã</option>
                                    <option value="in-progress">ÈÄ≤Ë°å‰∏≠</option>
                                    <option value="completed">ÂÆå‰∫Ü</option>
                                </select>
                            </div>

                            <div class="btn-group" style="grid-column: 1 / -1; margin-top: 16px;">
                                <button type="submit" class="btn btn-primary" id="taskSubmitBtn">‚ûï „Çø„Çπ„ÇØËøΩÂä†</button>
                                <button type="button" class="btn btn-secondary" id="cancelEditBtn" onclick="cancelEdit()" style="display: none;">„Ç≠„É£„É≥„Çª„É´</button>
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">‚Üë CSV„Ç§„É≥„Éù„Éº„Éà</button>
                                <input type="file" id="fileInput" accept=".csv" style="display: none;">
                            </div>
                        </form>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">„Çø„Çπ„ÇØ‰∏ÄË¶ß</h2>
                        </div>
                        <div class="hierarchical-task-list" id="taskList">
                            </div>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <div class="settings-grid">
                        <div class="card settings-card">
                            <h3 class="card-title">Â∫óËàóÁÆ°ÁêÜ</h3>
                            <div class="form-group">
                                <label class="form-label">Êñ∞„Åó„ÅÑÂ∫óËàóÂêç</label>
                                <input type="text" id="newStoreName" class="form-input" placeholder="‰æã: Ê∏ãË∞∑Â∫ó">
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="addStore()">‚ûï Â∫óËàó„ÇíËøΩÂä†</button>
                                <button class="btn btn-danger" onclick="deleteStore()">üóëÔ∏è ÈÅ∏ÊäûÂ∫óËàó„ÇíÂâäÈô§</button>
                            </div>
                        </div>

                        <div class="card settings-card">
                            <h3 class="card-title">„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ</h3>
                            <div id="userList" style="margin-bottom: 20px;">
                                </div>
                            <button class="btn btn-primary" onclick="openUserModal()">‚ûï „É¶„Éº„Ç∂„Éº„ÇíËøΩÂä†</button>
                        </div>

                        <div class="card settings-card" style="grid-column: 1 / -1;">
                            <h3 class="card-title" style="color: var(--danger);">„Éá„Éº„Çø„É™„Çª„ÉÉ„Éà</h3>
                            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">‚Äª„Åì„ÅÆÊìç‰Ωú„ÅØÂÖ®Â∫óËàó„ÅÆ„Çø„Çπ„ÇØ„ÄÅ„Çπ„Çø„ÉÉ„Éï„ÄÅ„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„ÄÅÂàùÊúüÁä∂ÊÖã„Å´Êàª„Åó„Åæ„Åô„ÄÇÂÖÉ„Å´Êàª„Åô„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ</p>
                            <button class="btn btn-danger" onclick="clearAllData()">üö® ÂÖ®„Éá„Éº„Çø„ÇíÂâäÈô§</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="staffModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="staffModalTitle">„Çπ„Çø„ÉÉ„ÉïËøΩÂä†</h2>
            </div>
            <form id="staffForm" onsubmit="addOrUpdateStaff(event)">
                <input type="hidden" id="staffIdToEdit">
                <div class="form-group">
                    <label class="form-label">ÂêçÂâç</label>
                    <input type="text" id="staffName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ÊãÖÂΩìÂΩπÂâ≤</label>
                    <input type="text" id="staffRole" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ÂΩπËÅ∑</label>
                    <input type="text" id="staffPosition" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">„É°„É¢„ÉªÁâπË®ò‰∫ãÈ†Ö</label>
                    <input type="text" id="staffNote" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ÈõªË©±Áï™Âè∑</label>
                    <input type="tel" id="staffPhone" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                    <input type="email" id="staffEmail" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">ÂÖ•Á§æÊó•</label>
                    <input type="date" id="staffJoinDate" class="form-input">
                </div>
                <div class="btn-group" style="margin-top: 16px;">
                    <button type="submit" class="btn btn-primary" id="staffSubmitBtn">ËøΩÂä†</button>
                    <button type="button" class="btn btn-secondary" onclick="closeStaffModal()">„Ç≠„É£„É≥„Çª„É´</button>
                </div>
            </form>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">„É¶„Éº„Ç∂„ÉºËøΩÂä†</h2>
            </div>
            <form id="userForm" onsubmit="addUser(event)">
                <div class="form-group">
                    <label class="form-label">ÂêçÂâç</label>
                    <input type="text" id="userName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                    <input type="email" id="userEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="userPassword" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ê®©Èôê</label>
                    <select id="userRole" class="form-input" required>
                        <option value="editor">Á∑®ÈõÜËÄÖ</option>
                        <option value="admin">ÁÆ°ÁêÜËÄÖ</option>
                    </select>
                </div>
                <div class="btn-group" style="margin-top: 16px;">
                    <button type="submit" class="btn btn-primary">ËøΩÂä†</button>
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">„Ç≠„É£„É≥„Çª„É´</button>
                </div>
            </form>
        </div>
    </div>


    <div id="login" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="logo" style="text-align: center;">üè™ I-STYLE Êñ∞Â∫ó„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</div>
            <h2 style="margin-top: 10px;">„É≠„Ç∞„Ç§„É≥</h2>
            <div id="loginError" class="login-error"></div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                    <input type="email" id="loginEmail" class="form-input" value="admin@istyle.co.jp" required>
                </div>
                <div class="form-group">
                    <label class="form-label">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="loginPassword" class="form-input" value="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">„É≠„Ç∞„Ç§„É≥</button>
            </form>
            <p style="text-align: center; font-size: 12px; color: var(--text-secondary); margin-top: 20px;">
                „ÉÜ„Çπ„Éà„Ç¢„Ç´„Ç¶„É≥„Éà: admin@istyle.co.jp / password
            </p>
        </div>
    </div>


    <script>
        // -------------------------------------------------------------------------
        // 1. „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å®„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
        // -------------------------------------------------------------------------

        const TASK_COL_WIDTH_MIN = 120;
        const DAY_WIDTH_MIN = 2;
        const DAY_WIDTH_MAX = 60;
        let DAY_WIDTH = 30; // 1Êó•„ÅÆË°®Á§∫ÂπÖÔºà„Éî„ÇØ„Çª„É´Ôºâ
        let TASK_COL_WIDTH = 280; // „Çø„Çπ„ÇØÂêçÂàó„ÅÆÂπÖÔºà„Çµ„Ç§„Éâ„Éê„Éº„Å®ÈÄ£ÂãïÔºâ

        const DELETE_PASSWORD = 'delete';
        let currentMonth = new Date(); // ÁèæÂú®Ë°®Á§∫„Åó„Å¶„ÅÑ„Çã„Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊúà

        let storeIdCounter = 1;
        let taskIdCounter = 33;
        let staffIdCounter = 8;
        let userIdCounter = 3;

        // -------------------------------------------------------------------------
        // 2. „Éá„Éº„ÇøÂÆöÁæ©„Å®ÂàùÊúüË®≠ÂÆö („Åì„Åì„ÅåÊúÄÊñ∞„Çø„Çπ„ÇØ„Éá„Éº„Çø„ÅßÊõ¥Êñ∞„Åï„Çå„Å¶„ÅÑ„Åæ„Åô)
        // -------------------------------------------------------------------------

        let stores = {
            'default': { // ÂàùÊúüË®≠ÂÆö„ÅÆ„Åü„ÇÅÊÆã„Åó„Å¶„Åä„Åè
                name: '„Éá„Éï„Ç©„É´„ÉàÂ∫óËàó',
                tasks: [],
                staff: []
            },
            'store_1700000000000': { // „É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„ÇíÂàùÊúüÂ∫óËàó„Å®„Åó„Å¶ÂÆöÁæ©
                name: '„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó',
                tasks: [
                    {
                        "id": 1,
                        "level": 1,
                        "parentTaskName": "",
                        "taskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "assignee": "Á´π‰πãÂÜÖ/ÁßãÂ±±",
                        "memo": "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂÖ®‰Ωì„ÅÆË¶™„Çø„Çπ„ÇØ",
                        "startDate": "2025-06-01",
                        "endDate": "2025-11-30",
                        "status": "in-progress"
                    },
                    {
                        "id": 2,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠Ë®à„ÉªÂÖ®‰ΩìË®àÁîª",
                        "assignee": "ÁßãÂ±±",
                        "memo": "ÂÖ®‰ΩìÂÉè„ÇíÂõ∫„ÇÅ„Çã„Éï„Çß„Éº„Ç∫",
                        "startDate": "2025-06-01",
                        "endDate": "2025-06-30",
                        "status": "in-progress"
                    },
                    {
                        "id": 3,
                        "level": 3,
                        "parentTaskName": "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠Ë®à„ÉªÂÖ®‰ΩìË®àÁîª",
                        "taskName": "Â£≤‰∏ä„ÉªÂÆ¢Êï∞„ÉªÂÆ¢Âçò‰æ°„Å™„Å©KGI/KPI„ÇíË®≠ÂÆö„Åô„Çã",
                        "assignee": "ÁßãÂ±±",
                        "memo": "1„É∂Êúà/3„É∂Êúà/1Âπ¥„ÅÆÁõÆÊ®ô",
                        "startDate": "2025-06-01",
                        "endDate": "2025-06-15",
                        "status": "completed"
                    },
                    {
                        "id": 4,
                        "level": 3,
                        "parentTaskName": "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠Ë®à„ÉªÂÖ®‰ΩìË®àÁîª",
                        "taskName": "„Éû„Çπ„Çø„Éº„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºà„Ç¨„É≥„Éà„ÉÅ„É£„Éº„ÉàÔºâ„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "ÁßãÂ±±",
                        "memo": "Êú¨„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´ÂèçÊò†",
                        "startDate": "2025-06-15",
                        "endDate": "2025-06-30",
                        "status": "in-progress"
                    },
                    {
                        "id": 5,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„Éá„Éô„É≠„ÉÉ„Éë„Éº„ÉªÂ•ëÁ¥ÑÈñ¢ÈÄ£",
                        "assignee": "Á´π‰πãÂÜÖ",
                        "memo": "„Éá„Éô„É≠„ÉÉ„Éë„Éº„Å®„ÅÆÁ™ìÂè£",
                        "startDate": "2025-06-01",
                        "endDate": "2025-08-31",
                        "status": "completed"
                    },
                    {
                        "id": 6,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "Ë®≠Ë®à„ÉªÂÜÖË£Ö„ÉªË®≠ÂÇô",
                        "assignee": "Á´π‰πãÂÜÖ/Ë®≠Ë®à‰∫ãÂãôÊâÄ",
                        "memo": "Â∫óËàó„Å•„Åè„ÇäÂÖ®Ëà¨",
                        "startDate": "2025-07-01",
                        "endDate": "2025-10-15",
                        "status": "in-progress"
                    },
                    {
                        "id": 7,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "assignee": "ÁßãÂ±±/Â∂åÁî∞",
                        "memo": "‰∫∫„ÅÆÁ¢∫‰øù„Å®ËÇ≤Êàê",
                        "startDate": "2025-08-01",
                        "endDate": "2025-10-25",
                        "status": "in-progress"
                    },
                    {
                        "id": 8,
                        "level": 3,
                        "parentTaskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "taskName": "ÁõÆÊ®ôÊé°Áî®‰∫∫Êï∞ÔºàÁ§æÂì°/„Ç¢„É´„Éê„Ç§„ÉàÔºâ„ÇíË®≠ÂÆö„Åô„Çã",
                        "assignee": "ÁßãÂ±±",
                        "memo": "„Éù„Ç∏„Ç∑„Éß„É≥„Åî„Å®„Å´",
                        "startDate": "2025-08-01",
                        "endDate": "2025-08-15",
                        "status": "completed"
                    },
                    {
                        "id": 9,
                        "level": 3,
                        "parentTaskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "taskName": "Êé°Áî®„Çπ„Ç±„Ç∏„É•„Éº„É´ÔºàÂ™í‰ΩìÈÅ∏ÂÆö/Èù¢Êé•/Á†î‰øÆÔºâ„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "Â∂åÁî∞",
                        "memo": "ÈÄÜÁÆó„Åó„Å¶",
                        "startDate": "2025-08-10",
                        "endDate": "2025-08-20",
                        "status": "completed"
                    },
                    {
                        "id": 10,
                        "level": 3,
                        "parentTaskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "taskName": "Êé°Áî®Â™í‰Ωì„Å∏Âá∫Á®ø„Åô„Çã",
                        "assignee": "Â∂åÁî∞",
                        "memo": "ÂéüÁ®øÂÜÖÂÆπ„ÇíÂêüÂë≥",
                        "startDate": "2025-08-20",
                        "endDate": "2025-09-05",
                        "status": "in-progress"
                    },
                    {
                        "id": 11,
                        "level": 3,
                        "parentTaskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "taskName": "Èù¢Êé•„ÉªÊé°Áî®„ÇíË°å„ÅÜ",
                        "assignee": "ÁßãÂ±±/Â∂åÁî∞",
                        "memo": "Âü∫Ê∫ñ„ÇíÁµ±‰∏Ä„Åó„Å¶",
                        "startDate": "2025-09-01",
                        "endDate": "2025-10-15",
                        "status": "in-progress"
                    },
                    {
                        "id": 12,
                        "level": 3,
                        "parentTaskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "taskName": "ÂÖ•Á§æ„ÉªÂàùÊúüÁ†î‰øÆË®àÁîª„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "ÁßãÂ±±",
                        "memo": "Â∫óËàó/Êú¨Á§æÂ∫ßÂ≠¶",
                        "startDate": "2025-09-15",
                        "endDate": "2025-09-30",
                        "status": "pending"
                    },
                    {
                        "id": 13,
                        "level": 3,
                        "parentTaskName": "Êé°Áî®„Éª‰∫∫Âì°„ÉªÊïôËÇ≤",
                        "taskName": "ÂÖ•Á§æ„ÉªÂàùÊúüÁ†î‰øÆ„ÇíÂÆüÊñΩ„Åô„Çã",
                        "assignee": "ÁßãÂ±±/Â∂åÁî∞",
                        "memo": "ÈÄ≤Êçó„ÇíÈÉΩÂ∫¶Á¢∫Ë™ç",
                        "startDate": "2025-10-01",
                        "endDate": "2025-10-25",
                        "status": "pending"
                    },
                    {
                        "id": 14,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Éª„Éû„Éã„É•„Ç¢„É´„Éª‰ªïÁµÑ„Åø",
                        "assignee": "Â∂åÁî∞„ÉªÂ§èÁõÆ",
                        "memo": "ÁèæÂ†¥„ÅÆÂõû„ÅóÊñπ„Å•„Åè„Çä",
                        "startDate": "2025-08-01",
                        "endDate": "2025-09-30",
                        "status": "in-progress"
                    },
                    {
                        "id": 15,
                        "level": 3,
                        "parentTaskName": "„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Éª„Éû„Éã„É•„Ç¢„É´„Éª‰ªïÁµÑ„Åø",
                        "taskName": "Ê∏ÖÊéÉÁØÑÂõ≤„ÉªÈ†ªÂ∫¶Ë°®Ôºà„Éá„Ç§„É™„Éº/„Ç¶„Ç£„Éº„ÇØ„É™„ÉºÔºâ„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "Â∂åÁî∞„ÉªÂ§èÁõÆ",
                        "memo": "ÊãÖÂΩìÂâ≤„Åæ„ÅßÊ±∫„ÇÅ„Çã",
                        "startDate": "2025-08-20",
                        "endDate": "2025-09-10",
                        "status": "in-progress"
                    },
                    {
                        "id": 16,
                        "level": 3,
                        "parentTaskName": "„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Éª„Éû„Éã„É•„Ç¢„É´„Éª‰ªïÁµÑ„Åø",
                        "taskName": "„É¨„Ç∏Êìç‰Ωú„Éû„Éã„É•„Ç¢„É´„Éª„Éà„É©„Éñ„É´ÂØæÂøúË°®„Çí‰Ωú„Çã",
                        "assignee": "Â∂åÁî∞„ÉªÂ§èÁõÆ",
                        "memo": "ÂÜôÁúü‰ªò„Åç„Å†„Å®‚óé",
                        "startDate": "2025-09-01",
                        "endDate": "2025-09-30",
                        "status": "pending"
                    },
                    {
                        "id": 17,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„É°„Éã„É•„Éº„ÉªÂïÜÂìÅ„ÉªÂéü‰æ°„Éª‰ªïÂÖ•„Çå",
                        "assignee": "Â±±Â¥é/„Éû„Éç„Éº„Ç∏„É£„Éº",
                        "memo": "FL/Âéü‰æ°ÁÆ°ÁêÜ",
                        "startDate": "2025-07-01",
                        "endDate": "2025-10-20",
                        "status": "in-progress"
                    },
                    {
                        "id": 18,
                        "level": 3,
                        "parentTaskName": "„É°„Éã„É•„Éº„ÉªÂïÜÂìÅ„ÉªÂéü‰æ°„Éª‰ªïÂÖ•„Çå",
                        "taskName": "FL„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "„Éû„Éç„Éº„Ç∏„É£„Éº",
                        "memo": "ÁõÆÊ®ôFL„Å®ÂÆüÁèæÊÄß",
                        "startDate": "2025-07-01",
                        "endDate": "2025-07-31",
                        "status": "completed"
                    },
                    {
                        "id": 19,
                        "level": 3,
                        "parentTaskName": "„É°„Éã„É•„Éº„ÉªÂïÜÂìÅ„ÉªÂéü‰æ°„Éª‰ªïÂÖ•„Çå",
                        "taskName": "ÈÖçÈÄÅÁ¢∫ÂÆö",
                        "assignee": "Â±±Â¥é",
                        "memo": "",
                        "startDate": "2025-10-01",
                        "endDate": "2025-10-20",
                        "status": "pending"
                    },
                    {
                        "id": 20,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "assignee": "ËçâÊü≥",
                        "memo": "SNS„ÄúÈ§®ÂÜÖË≤©‰øÉ",
                        "startDate": "2025-09-01",
                        "endDate": "2025-10-31",
                        "status": "in-progress"
                    },
                    {
                        "id": 21,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "„Çø„Éº„Ç≤„ÉÉ„ÉàÂÉè„Å®Âà©Áî®„Ç∑„Éº„É≥„ÇíÊï¥ÁêÜ„Åô„Çã",
                        "assignee": "ËçâÊü≥",
                        "memo": "„Éö„É´„ÇΩ„ÉäÁ∞°ÊòìË®≠ÂÆö",
                        "startDate": "2025-09-01",
                        "endDate": "2025-09-15",
                        "status": "completed"
                    },
                    {
                        "id": 22,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "„Ç≠„Éº„Éì„Ç∏„É•„Ç¢„É´„Éª„É°„Ç§„É≥ÂÜôÁúüÊíÆÂΩ±„ÇíË°å„ÅÜ",
                        "assignee": "ËçâÊü≥",
                        "memo": "ÂïÜÂìÅ/Â∫óÂÜÖ/‰∫∫Áâ©",
                        "startDate": "2025-09-10",
                        "endDate": "2025-09-25",
                        "status": "in-progress"
                    },
                    {
                        "id": 23,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "È§®ÂÜÖ„Éù„Çπ„Çø„Éº„ÉªPOP„Éá„Ç∂„Ç§„É≥„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "Â≤°Êú¨",
                        "memo": "„Çµ„Ç§„Ç∫Ë¶èÂÆö„Å´Âêà„Çè„Åõ„Çã",
                        "startDate": "2025-09-20",
                        "endDate": "2025-10-10",
                        "status": "in-progress"
                    },
                    {
                        "id": 24,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "„Éé„Éô„É´„ÉÜ„Ç£‰ºÅÁîªÔºàÂÜÖÂÆπ/„Ç≥„Çπ„Éà/Êï∞ÈáèÔºâ„ÇíÊ±∫„ÇÅ„Çã",
                        "assignee": "ËçâÊü≥",
                        "memo": "ÂÖàÁùÄ‚óØÂêç„Å™„Å©",
                        "startDate": "2025-09-15",
                        "endDate": "2025-09-30",
                        "status": "in-progress"
                    },
                    {
                        "id": 25,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "„Ç™„Éº„Éó„É≥ÂëäÁü•Áî®SNSÊäïÁ®øË®àÁîªÔºà„Ç´„É¨„É≥„ÉÄ„ÉºÔºâ„Çí‰ΩúÊàê„Åô„Çã",
                        "assignee": "ËçâÊü≥",
                        "memo": "„ÉÜ„Ç£„Ç∂„Éº„Äú„Ç™„Éº„Éó„É≥Âæå",
                        "startDate": "2025-09-25",
                        "endDate": "2025-10-15",
                        "status": "pending"
                    },
                    {
                        "id": 26,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "„Éó„É¨„Çπ„É™„É™„Éº„ÇπÂá∫Á®ø„ÅÆË¶ÅÂê¶„ÇíÊ±∫„ÇÅ„Çã",
                        "assignee": "ËçâÊü≥",
                        "memo": "ÂøÖË¶Å„Å™„ÇâÂéüÁ®ø‰ΩúÊàê",
                        "startDate": "2025-09-01",
                        "endDate": "2025-09-30",
                        "status": "pending"
                    },
                    {
                        "id": 27,
                        "level": 3,
                        "parentTaskName": "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„ÉªË≤©‰øÉ„Éª„Éñ„É©„É≥„Éá„Ç£„É≥„Ç∞",
                        "taskName": "È§®ÂÜÖ„ÉÅ„É©„Ç∑„ÉªÈ§®ÂÜÖÊîæÈÄÅ„Éª„É°„É´„Éû„Ç¨Á≠â„ÅÆÁî≥„ÅóËæº„Åø„ÇíË°å„ÅÜ",
                        "assignee": "ËçâÊü≥/Â§èÁõÆ",
                        "memo": "Á∑†ÂàáÁÆ°ÁêÜ",
                        "startDate": "2025-10-01",
                        "endDate": "2025-10-15",
                        "status": "pending"
                    },
                    {
                        "id": 28,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„Ç∑„Çπ„ÉÜ„É†„Éª„ÉÑ„Éº„É´„ÉªÂ∏≥Á•®",
                        "assignee": "Â∂åÁî∞",
                        "memo": "POS/Âã§ÊÄ†/Êó•Â†±„Å™„Å©",
                        "startDate": "2025-09-15",
                        "endDate": "2025-10-20",
                        "status": "in-progress"
                    },
                    {
                        "id": 29,
                        "level": 3,
                        "parentTaskName": "„Ç∑„Çπ„ÉÜ„É†„Éª„ÉÑ„Éº„É´„ÉªÂ∏≥Á•®",
                        "taskName": "Â£≤‰∏äÈõÜË®à„Ç∑„Çπ„ÉÜ„É†ÔºàASPITÁ≠âÔºâ„ÅÆÂ∫óËàóÁôªÈå≤„ÇíË°å„ÅÜ",
                        "assignee": "Â∂åÁî∞",
                        "memo": "ÈÉ®ÈñÄ„ÉªÂïÜÂìÅ„Ç≥„Éº„ÉâË®≠Ë®à",
                        "startDate": "2025-09-15",
                        "endDate": "2025-09-30",
                        "status": "in-progress"
                    },
                    {
                        "id": 30,
                        "level": 3,
                        "parentTaskName": "„Ç∑„Çπ„ÉÜ„É†„Éª„ÉÑ„Éº„É´„ÉªÂ∏≥Á•®",
                        "taskName": "Âã§ÊÄ†ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„ÅÆË®≠ÂÆö„ÇíË°å„ÅÜ",
                        "assignee": "Â∂åÁî∞",
                        "memo": "(ÂÖÉ„ÅÆ„Çø„Çπ„ÇØÂêç„ÄåÂã§...„Äç„Çí‰øÆÊ≠£)",
                        "startDate": "2025-10-01",
                        "endDate": "2025-10-15",
                        "status": "pending"
                    },
                    {
                        "id": 31,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "ÈñãÂ∫óÁõ¥ÂâçÊ∫ñÂÇô„Éª„É™„Éè„Éº„Çµ„É´",
                        "assignee": "Â∫óÈï∑/„Éû„Éç„Éº„Ç∏„É£„Éº",
                        "memo": "„Éó„É¨„Ç™„Éº„Éó„É≥ÂâçÂæå",
                        "startDate": "2025-10-20",
                        "endDate": "2025-10-31",
                        "status": "pending"
                    },
                    {
                        "id": 32,
                        "level": 2,
                        "parentTaskName": "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                        "taskName": "„Ç™„Éº„Éó„É≥ÂΩìÊó•„Äú1„É∂Êúà„Éï„Ç©„É≠„Éº",
                        "assignee": "Â∫óÈï∑/„Éû„Éç„Éº„Ç∏„É£„Éº",
                        "memo": "Á´ã„Å°‰∏ä„Åå„Çä„ÅÆÂÆâÂÆöÂåñ",
                        "startDate": "2025-11-01",
                        "endDate": "2025-11-30",
                        "status": "pending"
                    }
                ],
                staff: [
                    { id: 1, name: 'Á´π‰πãÂÜÖ', role: '„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË≤¨‰ªªËÄÖ', position: 'ÈÉ®Èï∑', phone: '090-xxxx-xxxx', email: 'takenouchi@istyle.co.jp', joinDate: '2015-04-01', note: '„Éá„Éô„É≠„ÉÉ„Éë„Éº„ÉªË®≠Ë®àÁ™ìÂè£' },
                    { id: 2, name: 'ÁßãÂ±±', role: 'Â∫óËàóÈñãÁô∫Ë≤¨‰ªªËÄÖ', position: '„Éû„Éç„Éº„Ç∏„É£„Éº', phone: '080-xxxx-xxxx', email: 'akiyama@istyle.co.jp', joinDate: '2018-06-15', note: 'Êé°Áî®„ÉªÂÖ®‰ΩìË®àÁîªÁ™ìÂè£' },
                    { id: 3, name: 'Â∂åÁî∞', role: 'Â∫óÈï∑ÂÄôË£ú', position: '‰∏ÄËà¨', phone: '070-xxxx-xxxx', email: 'shimada@istyle.co.jp', joinDate: '2023-01-20', note: '„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Éª„Ç∑„Çπ„ÉÜ„É†ÊãÖÂΩì' },
                    { id: 4, name: 'ËçâÊü≥', role: '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞ÊãÖÂΩì', position: '‰∏ÄËà¨', phone: '080-xxxx-xxxx', email: 'kusayanagi@istyle.co.jp', joinDate: '2022-11-01', note: 'SNS„ÉªË≤©‰øÉÊãÖÂΩì' },
                    { id: 5, name: 'Â±±Â¥é', role: 'ÂïÜÂìÅ„ÉªÂéü‰æ°ÊãÖÂΩì', position: '„Éû„Éç„Éº„Ç∏„É£„Éº', phone: '090-xxxx-xxxx', email: 'yamazaki@istyle.co.jp', joinDate: '2017-09-10', note: 'FLÁÆ°ÁêÜ' },
                    { id: 6, name: 'Â§èÁõÆ', role: 'Â∫óËàóÈÅãÂñ∂„ÉªÊïôËÇ≤ÊãÖÂΩì', position: '‰∏ÄËà¨', phone: '070-xxxx-xxxx', email: 'natsume@istyle.co.jp', joinDate: '2024-03-01', note: '„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥„Éû„Éã„É•„Ç¢„É´‰ΩúÊàê' },
                    { id: 7, name: 'Â≤°Êú¨', role: '„Éá„Ç∂„Ç§„Éä„Éº', position: 'Â•ëÁ¥ÑÁ§æÂì°', phone: '080-xxxx-xxxx', email: 'okamoto@istyle.co.jp', joinDate: '2024-06-01', note: 'Ë≤©‰øÉÁâ©„Éá„Ç∂„Ç§„É≥' }
                ]
            }
        };

        let currentStore = 'store_1700000000000'; // „É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„ÇíÂàùÊúüÈÅ∏ÊäûÂ∫óËàó„Å®„Åô„Çã

        let users = [
            { id: 1, name: 'ÁÆ°ÁêÜËÄÖA', email: 'admin@istyle.co.jp', password: 'password', role: 'admin' },
            { id: 2, name: 'Á∑®ÈõÜËÄÖB', email: 'editor@istyle.co.jp', password: 'password', role: 'editor' }
        ];

        let currentUser = null;
        let editingTaskId = null; // Á∑®ÈõÜ‰∏≠„ÅÆ„Çø„Çπ„ÇØID
        let resizingTask = null; // „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà„É™„Çµ„Ç§„Ç∫‰∏≠„ÅÆ„Çø„Çπ„ÇØ

        // -------------------------------------------------------------------------
        // 3. „Éá„Éº„Çø‰øùÂ≠ò„Éª„É≠„Éº„Éâ„Éª„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        // -------------------------------------------------------------------------

        // „Éá„Éº„Çø„ÇíLocalStorage„Å´‰øùÂ≠ò
        function saveData() {
            localStorage.setItem('istyle_stores', JSON.stringify(stores));
            localStorage.setItem('istyle_currentStore', currentStore);
            localStorage.setItem('istyle_taskIdCounter', taskIdCounter);
            localStorage.setItem('istyle_staffIdCounter', staffIdCounter);
            localStorage.setItem('istyle_userIdCounter', userIdCounter);
        }

        // „Éá„Éº„Çø„ÇíLocalStorage„Åã„Çâ„É≠„Éº„Éâ
        function loadData() {
            const savedStores = localStorage.getItem('istyle_stores');
            const savedCurrentStore = localStorage.getItem('istyle_currentStore');
            const savedTaskIdCounter = localStorage.getItem('istyle_taskIdCounter');
            const savedStaffIdCounter = localStorage.getItem('istyle_staffIdCounter');
            const savedUserIdCounter = localStorage.getItem('istyle_userIdCounter');
            
            if (savedStores) {
                stores = JSON.parse(savedStores);
            }
            if (savedCurrentStore && stores[savedCurrentStore]) {
                currentStore = savedCurrentStore;
            } else if (Object.keys(stores).length > 0) {
                currentStore = Object.keys(stores)[0];
            } else {
                currentStore = 'default';
            }

            if (savedTaskIdCounter) taskIdCounter = parseInt(savedTaskIdCounter);
            if (savedStaffIdCounter) staffIdCounter = parseInt(savedStaffIdCounter);
            if (savedUserIdCounter) userIdCounter = parseInt(savedUserIdCounter);

            // „É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÇÇ„É≠„Éº„Éâ
            const savedUsers = localStorage.getItem('istyle_users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            }
        }

        // ÁèæÂú®„ÅÆÂ∫óËàó„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
        function getCurrentStore() {
            return stores[currentStore];
        }

        // „Çø„Çπ„ÇØID„Åã„Çâ„Çø„Çπ„ÇØ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂèñÂæó
        function getTaskById(id) {
            return getCurrentStore().tasks.find(t => t.id === id);
        }

        // „Çπ„Çø„ÉÉ„ÉïID„Åã„Çâ„Çπ„Çø„ÉÉ„Éï„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂèñÂæó
        function getStaffById(id) {
            return getCurrentStore().staff.find(s => s.id === id);
        }

        // -------------------------------------------------------------------------
        // 4. UI/„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Èñ¢Êï∞
        // -------------------------------------------------------------------------

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`.nav-item[onclick*="'${tabId}'"]`).classList.add('active');

            // „Éò„ÉÉ„ÉÄ„Éº„Çø„Ç§„Éà„É´„ÅÆÊõ¥Êñ∞
            const titleMap = {
                'dashboard': 'üìä „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'gantt': 'üìÖ „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà',
                'calendar': 'üóìÔ∏è „Ç´„É¨„É≥„ÉÄ„Éº',
                'staff': 'üë• „Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ',
                'timeline': '‚è±Ô∏è „Çø„Ç§„É†„É©„Ç§„É≥',
                'tasks': 'üìã „Çø„Çπ„ÇØÁÆ°ÁêÜ',
                'settings': '‚öôÔ∏è Ë®≠ÂÆö'
            };
            document.getElementById('headerTitle').textContent = titleMap[tabId];
            document.getElementById('headerSubtitle').textContent = `${getCurrentStore().name} - „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂÖ®‰ΩìÂÉè`;

            // „É¢„Éê„Ç§„É´„Åã„Çâ„ÅÆÈÅ∑Áßª„Åß„Çµ„Ç§„Éâ„Éê„Éº„ÇíÈñâ„Åò„Çã
            if (window.innerWidth <= 768) {
                toggleSidebar(false);
            }

            // „Çø„ÉñÁâπÊúâ„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞„ÇíÂëº„Å≥Âá∫„Åô
            if (tabId === 'dashboard') renderDashboard();
            if (tabId === 'gantt') renderGanttChart();
            if (tabId === 'calendar') renderCalendar();
            if (tabId === 'staff') renderStaffList();
            if (tabId === 'timeline') renderTimeline();
            if (tabId === 'tasks') renderTaskList();
            if (tabId === 'settings') renderUserList(); // Ë®≠ÂÆöÁîªÈù¢„Åß„ÅØ„É¶„Éº„Ç∂„Éº„É™„Çπ„Éà„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        }

        // „É¢„Éê„Ç§„É´„Çµ„Ç§„Éâ„Éê„Éº„ÅÆ„Éà„Ç∞„É´
        function toggleSidebar(force) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            const isActive = sidebar.classList.contains('active');

            if (force === undefined) {
                force = !isActive;
            }

            if (force) {
                sidebar.classList.add('active');
                overlay.classList.add('active');
            } else {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        }

        // -------------------------------------------------------------------------
        // 5. Â∫óËàóÁÆ°ÁêÜÈñ¢Êï∞
        // -------------------------------------------------------------------------

        // Â∫óËàó„Çª„É¨„ÇØ„Çø„Éº„ÅÆÂàùÊúüÂåñ
        function initializeStoreSelector() {
            const select = document.getElementById('storeSelect');
            select.innerHTML = '';
            let isCurrentStoreInList = false;

            Object.keys(stores).forEach(storeId => {
                const store = stores[storeId];
                const option = document.createElement('option');
                option.value = storeId;
                option.textContent = store.name;
                if (storeId === currentStore) {
                    option.selected = true;
                    isCurrentStoreInList = true;
                }
                select.appendChild(option);
            });

            // currentStore„Åå‰∏çÊ≠£„Å™Â†¥ÂêàÔºàÂâäÈô§„Åï„Çå„ÅüÂ†¥Âêà„Å™„Å©Ôºâ„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
            if (!isCurrentStoreInList && Object.keys(stores).length > 0) {
                currentStore = Object.keys(stores)[0];
                select.value = currentStore;
            } else if (Object.keys(stores).length === 0) {
                 stores['default'] = { name: '„Éá„Éï„Ç©„É´„ÉàÂ∫óËàó', tasks: [], staff: [] };
                 currentStore = 'default';
                 initializeStoreSelector(); // ÂÜçÂ∏∞ÁöÑ„Å´Âëº„Å≥Âá∫„Åó„Å¶ÂàùÊúüÂåñ„ÇíÂÆå‰∫Ü„Åï„Åõ„Çã
                 return;
            }

            saveData();
            // renderAll(); // switchStore()„Åæ„Åü„ÅØcheckLogin()„ÅßÂëº„Å≥Âá∫„Åï„Çå„Çã„Åü„ÇÅ‰∏çË¶Å
        }

        // Â∫óËàóÂàá„ÇäÊõø„Åà
        function switchStore() {
            const select = document.getElementById('storeSelect');
            currentStore = select.value;
            saveData();
            renderAll();
        }

        // Â∫óËàóËøΩÂä†
        function addStore() {
            const nameInput = document.getElementById('newStoreName');
            const name = nameInput.value.trim();
            if (!name) {
                alert('Â∫óËàóÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            const storeId = 'store_' + Date.now();
            stores[storeId] = { 
                name: name, 
                tasks: [], 
                staff: [
                    // Êñ∞„Åó„ÅÑÂ∫óËàó„Å´„ÅØ„Éá„Éï„Ç©„É´„Éà„Åß„Çπ„Çø„ÉÉ„Éï„ÇíË®≠ÂÆö„Åó„Å¶„ÇÇËâØ„ÅÑ
                ] 
            };
            currentStore = storeId;
            saveData();
            initializeStoreSelector();
            renderAll();
            nameInput.value = '';
            alert(`‚úÖ ${name}„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ`);
        }

        // Â∫óËàóÂâäÈô§Ôºà„Éë„Çπ„ÉØ„Éº„Éâ‰øùË≠∑Ôºâ
        function deleteStore() {
            if (!currentStore || currentStore === 'default') {
                alert('„Éá„Éï„Ç©„É´„ÉàÂ∫óËàó„ÅØÂâäÈô§„Åß„Åç„Åæ„Åõ„Çì„ÄÇ');
                return;
            }
            const storeName = stores[currentStore].name;
            const password = prompt(`${storeName}„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ\n„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`);
            if (password !== DELETE_PASSWORD) {
                if (password !== null) {
                    alert('‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                }
                return;
            }
            if (confirm(`Êú¨ÂΩì„Å´${storeName}„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ`)) {
                delete stores[currentStore];
                const remainingStores = Object.keys(stores);
                if (remainingStores.length === 0) {
                    stores['default'] = { name: '„Éá„Éï„Ç©„É´„ÉàÂ∫óËàó', tasks: [], staff: [] };
                    currentStore = 'default';
                } else {
                    currentStore = remainingStores[0];
                }
                saveData();
                initializeStoreSelector();
                renderAll();
                alert('‚úÖ Â∫óËàó„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        }

        // -------------------------------------------------------------------------
        // 6. „Çø„Çπ„ÇØÁÆ°ÁêÜÈñ¢Êï∞
        // -------------------------------------------------------------------------

        // „Çø„Çπ„ÇØËøΩÂä†„Åæ„Åü„ÅØÊõ¥Êñ∞
        function addOrUpdateTask(event) {
            event.preventDefault();
            const store = getCurrentStore();

            const taskData = {
                level: parseInt(document.getElementById('taskLevel').value),
                parentTaskName: document.getElementById('taskParent').value.trim(),
                taskName: document.getElementById('taskName').value.trim(),
                assignee: document.getElementById('taskAssignee').value.trim(),
                memo: document.getElementById('taskMemo').value.trim(),
                startDate: document.getElementById('taskStart').value,
                endDate: document.getElementById('taskEnd').value,
                status: document.getElementById('taskStatus').value
            };

            if (taskData.startDate > taskData.endDate) {
                alert('ÁµÇ‰∫ÜÊó•„ÅØÈñãÂßãÊó•‰ª•Èôç„ÅÆÊó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            if (editingTaskId !== null) {
                // Êõ¥Êñ∞Âá¶ÁêÜ
                const task = store.tasks.find(t => t.id === editingTaskId);
                if (task) {
                    Object.assign(task, taskData);
                    alert(`‚úÖ „Çø„Çπ„ÇØID ${editingTaskId} „ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü„ÄÇ`);
                }
                cancelEdit();
            } else {
                // Êñ∞Ë¶èËøΩÂä†Âá¶ÁêÜ
                const newTask = {
                    id: taskIdCounter++,
                    ...taskData
                };
                store.tasks.push(newTask);
                alert(`‚úÖ „Çø„Çπ„ÇØ„Äå${newTask.taskName}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ`);
                document.getElementById('taskForm').reset();
            }

            saveData();
            renderAll();
        }

        // „Çø„Çπ„ÇØÂâäÈô§
        function deleteTask(taskId) {
            if (!confirm('„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            const store = getCurrentStore();
            const initialLength = store.tasks.length;
            store.tasks = store.tasks.filter(t => t.id !== taskId);

            if (store.tasks.length < initialLength) {
                saveData();
                renderAll();
                alert('‚úÖ „Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        }

        // „Çø„Çπ„ÇØÁ∑®ÈõÜ„É¢„Éº„ÉâÈñãÂßã
        function editTask(taskId) {
            const task = getTaskById(taskId);
            if (!task) {
                alert('„Çø„Çπ„ÇØ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ');
                return;
            }
            editingTaskId = taskId;

            document.getElementById('taskIdToEdit').value = task.id;
            document.getElementById('taskLevel').value = task.level;
            document.getElementById('taskParent').value = task.parentTaskName || '';
            document.getElementById('taskName').value = task.taskName;
            document.getElementById('taskAssignee').value = task.assignee;
            document.getElementById('taskMemo').value = task.memo || '';
            document.getElementById('taskStart').value = task.startDate;
            document.getElementById('taskEnd').value = task.endDate;
            document.getElementById('taskStatus').value = task.status;

            // „Çø„Çπ„ÇØ„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà
            const taskTab = document.querySelector('.nav-item[onclick*="tasks"]');
            if (taskTab) {
                taskTab.click();
            }

            // „Éï„Ç©„Éº„É†„Çí„Éè„Ç§„É©„Ç§„Éà
            const submitBtn = document.getElementById('taskSubmitBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            submitBtn.textContent = '‚úèÔ∏è „Çø„Çπ„ÇØ„ÇíÊõ¥Êñ∞';
            submitBtn.className = 'btn btn-success';
            cancelBtn.style.display = 'block';

            // „Éï„Ç©„Éº„É†„Åæ„Åß„Çπ„ÇØ„É≠„Éº„É´
            setTimeout(() => {
                document.querySelector('form').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);

            alert('üìù „Çø„Çπ„ÇØ„ÇíÁ∑®ÈõÜ„É¢„Éº„Éâ„ÅßË™≠„ÅøËæº„Åø„Åæ„Åó„Åü„ÄÇ');
        }

        // Á∑®ÈõÜ„Ç≠„É£„É≥„Çª„É´
        function cancelEdit() {
            editingTaskId = null;
            const submitBtn = document.getElementById('taskSubmitBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            submitBtn.textContent = '‚ûï „Çø„Çπ„ÇØËøΩÂä†';
            submitBtn.className = 'btn btn-primary';
            cancelBtn.style.display = 'none';
            document.querySelector('#taskForm').reset();
            document.getElementById('taskIdToEdit').value = '';
        }
        
        // CSV„Éï„Ç°„Ç§„É´„ÅÆ„Éë„Éº„Çπ„Å®„Ç§„É≥„Éù„Éº„Éà
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) throw new Error('„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô„ÄÇ');
            
            // „Éò„ÉÉ„ÉÄ„ÉºË°å„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„ÄÅIDË°å„Çí‰øÆÊ≠£
            const headers = lines[0].split(',').map(h => h.trim());
            const dataLines = lines.slice(1);
            
            // ÊúüÂæÖ„Åï„Çå„Çã„Éò„ÉÉ„ÉÄ„Éº: ID,„É¨„Éô„É´,Ë¶™„Çø„Çπ„ÇØÂêç,„Çø„Çπ„ÇØÂêç,ÊãÖÂΩì,„É°„É¢,startDate,endDate,status
            const expectedHeaders = ["ID", "„É¨„Éô„É´", "Ë¶™„Çø„Çπ„ÇØÂêç", "„Çø„Çπ„ÇØÂêç", "ÊãÖÂΩì", "„É°„É¢", "startDate", "endDate", "status"];
            const isCorrectFormat = expectedHeaders.every((h, i) => headers[i] === h);

            if (!isCorrectFormat) {
                 // ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„ÄÇID„Åå„Å™„ÅÑÂè§„ÅÑ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅÆCSV„ÇíË®±ÂèØ„Åô„Çã
                const oldHeaders = ["„É¨„Éô„É´", "Ë¶™„Çø„Çπ„ÇØÂêç", "„Çø„Çπ„ÇØÂêç", "ÊãÖÂΩì", "„É°„É¢"];
                const isOldFormat = oldHeaders.every((h, i) => lines[0].split(',').map(h => h.trim())[i] === h);
                if (isOldFormat) {
                    alert('Âè§„ÅÑCSV„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÇíÊ§úÂá∫„Åó„Åæ„Åó„Åü„ÄÇID, startDate, endDate, status„ÅåËá™Âãï„ÅßÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Åæ„Åô„ÄÇ');
                    // Âè§„ÅÑ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅÆÂ†¥Âêà„ÄÅ„Éò„ÉÉ„ÉÄ„Éº„Å´ID, startDate, endDate, status„ÇíËøΩÂä†
                    headers.unshift("ID");
                    headers.push("startDate", "endDate", "status");
                } else {
                    throw new Error('CSV„Éò„ÉÉ„ÉÄ„Éº„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊúüÂæÖ„Åï„Çå„ÇãÂΩ¢Âºè: ' + expectedHeaders.join(','));
                }
            }


            const newTasks = [];
            let maxId = taskIdCounter;

            dataLines.forEach((line, index) => {
                const values = line.split(',');
                if (values.length < headers.length) {
                    console.warn(`Ë°å ${index + 2} „Çí„Çπ„Ç≠„ÉÉ„Éó: ÂàóÊï∞„ÅåË∂≥„Çä„Åæ„Åõ„Çì„ÄÇ`);
                    return;
                }

                const task = {};
                if(isCorrectFormat) {
                    task.id = parseInt(values[0]) || maxId++;
                } else {
                    // Âè§„ÅÑ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅÆÂ†¥Âêà
                    task.id = maxId++;
                    values.unshift(task.id); // ID„ÇíÂÖàÈ†≠„Å´ËøΩÂä†
                }
                
                task.level = parseInt(values[1]) || 1;
                task.parentTaskName = values[2].trim();
                task.taskName = values[3].trim();
                task.assignee = values[4].trim();
                task.memo = values[5].trim();
                
                // startDate, endDate, status„ÅÆÂá¶ÁêÜ
                if (values.length >= 9) {
                    task.startDate = values[6].trim() || '2025-01-01';
                    task.endDate = values[7].trim() || '2025-01-01';
                    task.status = values[8].trim() || 'pending';
                } else {
                    task.startDate = '2025-01-01';
                    task.endDate = '2025-01-01';
                    task.status = 'pending';
                }

                newTasks.push(task);
            });

            if (newTasks.length > 0) {
                const store = getCurrentStore();
                store.tasks = newTasks; // Êó¢Â≠ò„ÅÆ„Çø„Çπ„ÇØ„ÇíÁΩÆ„ÅçÊèõ„Åà
                taskIdCounter = maxId;
                saveData();
                renderAll();
                alert(`‚úÖ ${newTasks.length} ‰ª∂„ÅÆ„Çø„Çπ„ÇØ„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü„ÄÇ`);
            } else {
                 alert('„Ç§„É≥„Éù„Éº„Éà„Åï„Çå„Åü„Çø„Çπ„ÇØ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
            }
        }
        
        // „Éï„Ç°„Ç§„É´„Ç§„É≥„Éù„Éº„ÉàË®≠ÂÆö
        function setupFileImport() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput) return;
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        parseCSV(e.target.result);
                    } catch (error) {
                        alert('CSV„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                    }
                };
                // UTF-8„Åß„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„ÇÄ
                reader.readAsText(file, 'UTF-8');
            }, false);
        }
        

        // -------------------------------------------------------------------------
        // 7. „É¨„É≥„ÉÄ„É™„É≥„Ç∞Èñ¢Êï∞
        // -------------------------------------------------------------------------

        // „Çø„Çπ„ÇØ„É™„Çπ„ÉàÊèèÁîª
        function renderTaskList() {
            const container = document.getElementById('taskList');
            const store = getCurrentStore();
            const tasks = store.tasks;

            if (tasks.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>';
                return;
            }

            // ÈöéÂ±§ÊßãÈÄ†„ÅÆÊßãÁØâ
            const taskMap = {};
            tasks.forEach(task => taskMap[task.taskName] = task);

            const rootTasks = tasks.filter(task => !task.parentTaskName || !taskMap[task.parentTaskName]);

            // „É¨„É≥„ÉÄ„É™„É≥„Ç∞Áî®„ÅÆHTMLÁîüÊàê
            const renderTask = (task) => {
                const statusClass = task.status.replace('-', '');
                return `
                    <div class="task-item level-${task.level}">
                        <div class="task-header">
                            <div class="task-name">${task.taskName}</div>
                            <div class="task-status ${statusClass}">${task.status === 'pending' ? 'Êú™ÁùÄÊâã' : task.status === 'in-progress' ? 'ÈÄ≤Ë°å‰∏≠' : 'ÂÆå‰∫Ü'}</div>
                        </div>
                        <div class="task-meta">
                            <span>üìÖ ${task.startDate} ~ ${task.endDate}</span>
                            <span class="task-assignee">${task.assignee || 'Êú™ÂÆö'}</span>
                            <span>Lv.${task.level}</span>
                            <span>ID:${task.id}</span>
                        </div>
                        ${task.memo ? `<div class="task-memo">${task.memo}</div>` : ''}
                        <div class="task-actions">
                            <button class="btn-edit" onclick="editTask(${task.id})">Á∑®ÈõÜ</button>
                            <button class="btn-delete" onclick="deleteTask(${task.id})">ÂâäÈô§</button>
                        </div>
                    </div>
                `;
            };

            const renderTaskGroup = (task) => {
                let html = renderTask(task);

                const children = tasks.filter(t => t.parentTaskName === task.taskName);
                if (children.length > 0) {
                    html += '<div class="child-tasks">';
                    children.sort((a, b) => a.level - b.level).forEach(child => {
                        html += renderTaskGroup(child); // ÂÜçÂ∏∞Âëº„Å≥Âá∫„Åó
                    });
                    html += '</div>';
                }
                return html;
            };

            container.innerHTML = rootTasks.map(task => `
                <div class="task-group">
                    ${renderTaskGroup(task)}
                </div>
            `).join('');
        }


        // „Ç¨„É≥„Éà„ÉÅ„É£„Éº„ÉàÊèèÁîªÔºà2025Âπ¥1Êúà1Êó• „Äú 2026Âπ¥12Êúà31Êó•„ÄÅÊó•Âà•Ôºâ
        function renderGanttChart() {
            const container = document.getElementById('ganttRows');
            const taskNamesContainer = document.getElementById('ganttTaskNames');
            const headerContainer = document.getElementById('ganttHeaderFixed');
            const store = getCurrentStore();
            const tasks = store.tasks;

            // ÂàùÊúüÊúüÈñìË®≠ÂÆö
            const minDate = new Date(2025, 0, 1); // 2025Âπ¥1Êúà1Êó•
            const maxDate = new Date(2026, 11, 31); // 2026Âπ¥12Êúà31Êó•

            if (tasks.length === 0) {
                document.getElementById('ganttChart').innerHTML = '<div class="empty-state" style="margin-left: 20px;"><div class="empty-state-icon">üìÖ</div><div class="empty-state-text">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>';
                container.innerHTML = '';
                taskNamesContainer.innerHTML = '';
                headerContainer.innerHTML = '';
                return;
            }

            // ÊúüÈñìÂÜÖ„ÅÆÂÖ®„Å¶„ÅÆÊó•‰ªò„ÇíÁîüÊàê
            const allDays = [];
            let currentDate = new Date(minDate);
            while (currentDate <= maxDate) {
                allDays.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // 1. „Éò„ÉÉ„ÉÄ„ÉºÊèèÁîª
            let yearHeaderHTML = '<div class="gantt-year-header">';
            let monthHeaderHTML = '<div class="gantt-month-header">';
            let dayHeaderHTML = '<div class="gantt-day-header">';

            let currentYear = minDate.getFullYear();
            let currentMonth = minDate.getMonth();
            let currentYearDays = 0;
            let currentMonthDays = 0;

            allDays.forEach((date, index) => {
                const day = date.getDate();
                const month = date.getMonth();
                const year = date.getFullYear();
                const dayOfWeek = date.getDay(); // 0:Êó•, 6:Âúü
                const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
                const isToday = date.toDateString() === new Date().toDateString();

                // Êó•‰ªò„Éò„ÉÉ„ÉÄ„Éº„ÅÆÊèèÁîª
                dayHeaderHTML += `<div class="gantt-day-cell ${isWeekend ? 'weekend' : ''} ${isToday ? 'today' : ''}" style="flex: 0 0 ${DAY_WIDTH}px; width: ${DAY_WIDTH}px;">
                    ${day}
                </div>`;
                
                // Êúà„ÅåÂ§â„Çè„Å£„ÅüÊôÇ
                if (month !== currentMonth) {
                    if (currentMonthDays > 0) {
                        monthHeaderHTML += `<div class="gantt-month-block" style="flex: 0 0 ${currentMonthDays * DAY_WIDTH}px; width: ${currentMonthDays * DAY_WIDTH}px;">
                            ${currentMonth + 1}Êúà
                        </div>`;
                    }
                    currentMonth = month;
                    currentMonthDays = 0;
                }
                currentMonthDays++;

                // Âπ¥„ÅåÂ§â„Çè„Å£„ÅüÊôÇ
                if (year !== currentYear) {
                    if (currentYearDays > 0) {
                         yearHeaderHTML += `<div class="gantt-year-block" style="flex: 0 0 ${currentYearDays * DAY_WIDTH}px; width: ${currentYearDays * DAY_WIDTH}px;">
                            ${currentYear}Âπ¥
                        </div>`;
                    }
                    currentYear = year;
                    currentYearDays = 0;
                }
                currentYearDays++;
            });

            // ÊúÄÂæå„ÅÆÊúà„Å®Âπ¥„ÇíÈñâ„Åò„Çã
            if (currentMonthDays > 0) {
                monthHeaderHTML += `<div class="gantt-month-block" style="flex: 0 0 ${currentMonthDays * DAY_WIDTH}px; width: ${currentMonthDays * DAY_WIDTH}px;">
                    ${currentMonth + 1}Êúà
                </div>`;
            }
            if (currentYearDays > 0) {
                 yearHeaderHTML += `<div class="gantt-year-block" style="flex: 0 0 ${currentYearDays * DAY_WIDTH}px; width: ${currentYearDays * DAY_WIDTH}px;">
                    ${currentYear}Âπ¥
                </div>`;
            }

            yearHeaderHTML += '</div>';
            monthHeaderHTML += '</div>';
            dayHeaderHTML += '</div>';

            headerContainer.innerHTML = yearHeaderHTML + monthHeaderHTML + dayHeaderHTML;


            // 2. „Çø„Çπ„ÇØË°å„Å®„Ç¨„É≥„Éà„Éê„Éº„ÅÆÊèèÁîª
            let ganttRowsHTML = '';
            let taskNamesHTML = '';

            // ÈöéÂ±§Ë°®Á§∫„ÅÆ„Åü„ÇÅ„Å´„ÇΩ„Éº„Éà
            const sortedTasks = [...tasks].sort((a, b) => {
                if (a.level !== b.level) return a.level - b.level;
                return a.id - b.id;
            });
            
            const taskMap = {};
            tasks.forEach(task => taskMap[task.taskName] = task);

            // ÈöéÂ±§ÊßãÈÄ†„Å´Êï¥ÁêÜ
            const getTaskChildren = (taskName) => {
                return tasks.filter(t => t.parentTaskName === taskName).sort((a, b) => a.id - b.id);
            };

            const rootTasks = tasks.filter(task => task.level === 1 || !task.parentTaskName || !taskMap[task.parentTaskName]);
            
            let taskDisplayOrder = [];
            const buildDisplayOrder = (task) => {
                taskDisplayOrder.push(task);
                getTaskChildren(task.taskName).forEach(child => buildDisplayOrder(child));
            };
            
            rootTasks.sort((a, b) => a.id - b.id).forEach(task => buildDisplayOrder(task));


            taskDisplayOrder.forEach(task => {
                const start = new Date(task.startDate);
                const end = new Date(task.endDate);

                // Êó•‰ªò„Çí„ÄåÊó•„Äç„ÅßÊØîËºÉ„Åô„Çã„Åü„ÇÅ„Å´Ê≠£Ë¶èÂåñ
                const normalizeDate = (date) => new Date(date.getFullYear(), date.getMonth(), date.getDate());
                
                const startIndex = allDays.findIndex(d => normalizeDate(d).getTime() === normalizeDate(start).getTime());
                const endIndex = allDays.findIndex(d => normalizeDate(d).getTime() === normalizeDate(end).getTime());

                // „Çø„Çπ„ÇØÊÉÖÂ†±Âàó
                taskNamesHTML += `
                    <div class="gantt-row level-${task.level}">
                        <div class="gantt-task-info" style="width: ${TASK_COL_WIDTH}px;">
                            <div style="width: 100%; overflow: hidden; padding: 4px;">
                                <div style="font-weight: 600; margin-bottom: 2px; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; line-height: 1.2;">${task.taskName}</div>
                                <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.2;">${task.assignee || 'Êú™ÂÆö'} / ${task.status === 'pending' ? 'Êú™ÁùÄÊâã' : task.status === 'in-progress' ? 'ÈÄ≤Ë°å‰∏≠' : 'ÂÆå‰∫Ü'}</div>
                            </div>
                        </div>
                    </div>
                `;

                let barHTML = '';
                let bgHTML = '';
                
                // ËÉåÊôØ„ÅÆÊèèÁîªÔºàÈÄ±Êú´„Éè„Ç§„É©„Ç§„ÉàÔºâ
                allDays.forEach((date, index) => {
                    const dayOfWeek = date.getDay(); // 0:Êó•, 6:Âúü
                    const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
                    bgHTML += `<div class="gantt-day-bg ${isWeekend ? 'weekend' : ''}" style="flex: 0 0 ${DAY_WIDTH}px; width: ${DAY_WIDTH}px;"></div>`;
                });


                if (startIndex !== -1 && endIndex !== -1 && startIndex <= endIndex) {
                    const leftPos = startIndex * DAY_WIDTH;
                    const width = (endIndex - startIndex + 1) * DAY_WIDTH;
                    const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1; // Êó•Êï∞Ë®àÁÆó

                    let barColor = 'var(--primary)';
                    if (task.status === 'completed') {
                        barColor = 'var(--success)';
                    } else if (task.status === 'in-progress') {
                        barColor = 'var(--warning)';
                    } else if (task.status === 'pending') {
                        barColor = 'var(--secondary)';
                    }
                    
                    barHTML = `
                        <div class="gantt-bar" 
                            style="left: ${leftPos}px; width: ${width}px; background: ${barColor};"
                            data-task-id="${task.id}"
                            data-duration="${duration}">
                            ${task.taskName}
                            <div class="gantt-bar-resize-left" onmousedown="startGanttResize(event, ${task.id}, 'left')"></div>
                            <div class="gantt-bar-resize-right" onmousedown="startGanttResize(event, ${task.id}, 'right')"></div>
                        </div>
                    `;
                }

                ganttRowsHTML += `
                    <div class="gantt-row level-${task.level}">
                        <div class="gantt-timeline-row" onmousedown="startGanttDrag(event, ${task.id})">
                            <div class="gantt-timeline-bg">
                                ${bgHTML}
                            </div>
                            ${barHTML}
                        </div>
                    </div>
                `;
            });

            // 3. ‰ªäÊó•„ÅÆÁ∑ö
            const today = normalizeDate(new Date());
            const todayIndex = allDays.findIndex(d => normalizeDate(d).getTime() === today.getTime());

            let todayLineHTML = '';
            if (todayIndex !== -1) {
                const todayLeft = todayIndex * DAY_WIDTH + (DAY_WIDTH / 2) - 1.5;
                todayLineHTML = `<div class="gantt-today-line" style="left: ${todayLeft}px;"></div>`;
            }

            container.innerHTML = ganttRowsHTML + todayLineHTML;
            taskNamesContainer.innerHTML = taskNamesHTML;

            // „Çø„Ç§„É†„É©„Ç§„É≥ÂÖ®‰Ωì„ÅÆÂπÖ„ÇíË®≠ÂÆö
            const totalWidth = allDays.length * DAY_WIDTH;
            document.getElementById('ganttTimelineWrapper').style.minWidth = totalWidth + 'px';
            
            // ÂàùÂõûÊèèÁîªÊôÇ„Å´‰ªäÊó•„Å´„Çπ„ÇØ„É≠„Éº„É´
            const scrollWrapper = document.getElementById('ganttScrollWrapper');
            if (scrollWrapper && todayIndex !== -1) {
                const scrollPos = todayIndex * DAY_WIDTH - scrollWrapper.clientWidth / 2 + DAY_WIDTH / 2;
                setTimeout(() => {
                    scrollWrapper.scrollLeft = scrollPos;
                }, 100);
            }
        }
        
        // „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà „Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ („Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà)
        let draggedTask = null;
        const startGanttDrag = (e, taskId) => {
            // „Éê„ÉºËá™‰Ωì„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„ÅüÂ†¥Âêà„ÅÆ„Åø„Éâ„É©„ÉÉ„Ç∞„ÇíË®±ÂèØ
            const bar = e.target.closest('.gantt-bar');
            if (!bar || e.target.classList.contains('gantt-bar-resize-left') || e.target.classList.contains('gantt-bar-resize-right')) return;

            e.preventDefault();
            draggedTask = {
                id: taskId,
                startX: e.clientX,
                bar: bar,
                initialLeft: parseInt(bar.style.left) || 0
            };
            bar.classList.add('dragging');
            document.addEventListener('mousemove', handleGanttDrag);
            document.addEventListener('mouseup', endGanttDrag);
        }

        const handleGanttDrag = (e) => {
            if (!draggedTask) return;
            e.preventDefault();

            const deltaX = e.clientX - draggedTask.startX;
            const daysDelta = Math.round(deltaX / DAY_WIDTH);
            
            if (daysDelta === 0) return;

            const newLeft = draggedTask.initialLeft + (daysDelta * DAY_WIDTH);
            
            // Â∑¶Á´Ø„ÅÆÂà∂Èôê (0Êú™Ê∫Ä„Å´„Åó„Å™„ÅÑ)
            if (newLeft >= 0) {
                draggedTask.bar.style.left = newLeft + 'px';
            }
        }

        const endGanttDrag = (e) => {
            if (!draggedTask) return;
            const bar = draggedTask.bar;

            bar.classList.remove('dragging');
            
            // ÊúÄÁµÇ‰ΩçÁΩÆ„ÇíË®àÁÆó
            const leftPos = parseInt(bar.style.left) || 0;
            const dayOffset = Math.round(leftPos / DAY_WIDTH);
            const minDate = new Date(2025, 0, 1);
            
            const newStartDate = new Date(minDate);
            newStartDate.setDate(newStartDate.getDate() + dayOffset);
            
            const duration = parseInt(bar.dataset.duration);
            const newEndDate = new Date(newStartDate);
            newEndDate.setDate(newEndDate.getDate() + duration - 1);

            const store = getCurrentStore();
            const task = store.tasks.find(t => t.id === draggedTask.id);
            
            if (task) {
                // Êó•‰ªò„Çí 'YYYY-MM-DD' ÂΩ¢Âºè„Å´Êï¥ÂΩ¢
                task.startDate = newStartDate.toISOString().split('T')[0];
                task.endDate = newEndDate.toISOString().split('T')[0];
                saveData();
                renderAll();
            }

            draggedTask = null;
            document.removeEventListener('mousemove', handleGanttDrag);
            document.removeEventListener('mouseup', endGanttDrag);
        }
        
        // „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà „É™„Çµ„Ç§„Ç∫Ê©üËÉΩ („Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà)
        let resizingTask = null;

        const startGanttResize = (e, taskId, type) => {
            e.preventDefault();
            e.stopPropagation(); // „Éâ„É©„ÉÉ„Ç∞„Ç§„Éô„É≥„Éà„ÇíÈò≤Ê≠¢

            const bar = e.target.closest('.gantt-bar');
            if (!bar) return;

            const store = getCurrentStore();
            const task = store.tasks.find(t => t.id === taskId);
            
            if (!task) return;

            const minDate = new Date(2025, 0, 1);
            const startDate = new Date(task.startDate);
            const startDayOffset = Math.round((startDate.getTime() - minDate.getTime()) / (1000 * 60 * 60 * 24));

            resizingTask = {
                id: taskId,
                type: type,
                startX: e.clientX,
                bar: bar,
                initialWidth: parseInt(bar.style.width) || 0,
                initialLeft: parseInt(bar.style.left) || 0,
                initialOffset: startDayOffset,
                initialDuration: parseInt(bar.dataset.duration),
            };

            bar.classList.add('dragging'); // „Çπ„Çø„Ç§„É´„ÅØ„Éâ„É©„ÉÉ„Ç∞„Å®ÂÖ±Êúâ
            document.addEventListener('mousemove', handleGanttResize);
            document.addEventListener('mouseup', endGanttResize);
        }

        const handleGanttResize = (e) => {
            if (!resizingTask) return;
            e.preventDefault();

            const deltaX = e.clientX - resizingTask.startX;
            const daysDelta = Math.round(deltaX / DAY_WIDTH);
            
            if (daysDelta === 0) return;
            
            const bar = resizingTask.bar;

            if (resizingTask.type === 'right') {
                const newWidth = resizingTask.initialWidth + (daysDelta * DAY_WIDTH);
                const newDuration = resizingTask.initialDuration + daysDelta;

                if (newDuration >= 1) { // ÊúÄÂ∞è1Êó•„Çí‰øùË®º
                    bar.style.width = newWidth + 'px';
                    bar.dataset.duration = newDuration;
                }
            } else if (resizingTask.type === 'left') {
                const newWidth = resizingTask.initialWidth - (daysDelta * DAY_WIDTH);
                const newLeft = resizingTask.initialLeft + (daysDelta * DAY_WIDTH);
                const newDuration = resizingTask.initialDuration - daysDelta;
                
                if (newDuration >= 1 && newLeft >= 0) { // ÊúÄÂ∞è1Êó•„Å®Â∑¶Á´ØÂà∂Èôê„Çí‰øùË®º
                    bar.style.width = newWidth + 'px';
                    bar.style.left = newLeft + 'px';
                    bar.dataset.duration = newDuration;
                }
            }
        }

        const endGanttResize = (e) => {
            if (!resizingTask) return;
            const bar = resizingTask.bar;

            bar.classList.remove('dragging');

            const minDate = new Date(2025, 0, 1);
            const duration = parseInt(bar.dataset.duration);
            
            if (resizingTask.type === 'right') {
                 // ÈñãÂßãÊó•„ÅØ„Åù„ÅÆ„Åæ„Åæ
                 const newStartDate = new Date(minDate);
                 newStartDate.setDate(newStartDate.getDate() + resizingTask.initialOffset);
                 
                 const newEndDate = new Date(newStartDate);
                 newEndDate.setDate(newEndDate.getDate() + duration - 1);
                 
                 const store = getCurrentStore();
                 const task = store.tasks.find(t => t.id === resizingTask.id);
                 if (task) {
                     task.endDate = newEndDate.toISOString().split('T')[0];
                     saveData();
                 }
            } else if (resizingTask.type === 'left') {
                const leftPos = parseInt(bar.style.left) || 0;
                const startDayOffset = Math.round(leftPos / DAY_WIDTH);

                const newStartDate = new Date(minDate);
                newStartDate.setDate(newStartDate.getDate() + startDayOffset);
                
                const newEndDate = new Date(newStartDate);
                newEndDate.setDate(newEndDate.getDate() + duration - 1);

                const store = getCurrentStore();
                const task = store.tasks.find(t => t.id === resizingTask.id);
                if (task) {
                    task.startDate = newStartDate.toISOString().split('T')[0];
                    task.endDate = newEndDate.toISOString().split('T')[0];
                    saveData();
                }
            }

            resizingTask = null;
            renderAll(); // Â§âÊõ¥Âæå„ÅÆÊó•‰ªò„ÇíÂèçÊò†„Åó„Å¶ÂÜçÊèèÁîª
            document.removeEventListener('mousemove', handleGanttResize);
            document.removeEventListener('mouseup', endGanttResize);
        }

        // „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà „Ç∫„Éº„É†Ê©üËÉΩ
        function zoomIn() {
            if (DAY_WIDTH < DAY_WIDTH_MAX) {
                DAY_WIDTH += 3;
                TASK_COL_WIDTH = Math.max(TASK_COL_WIDTH_MIN, Math.round(DAY_WIDTH * 8));
                renderGanttChart();
                updateZoomDisplay();
            }
        }

        function zoomOut() {
            if (DAY_WIDTH > DAY_WIDTH_MIN) {
                DAY_WIDTH -= 3;
                TASK_COL_WIDTH = Math.max(TASK_COL_WIDTH_MIN, Math.round(DAY_WIDTH * 8));
                renderGanttChart();
                updateZoomDisplay();
            }
        }

        function resetZoom() {
            DAY_WIDTH = 30;
            TASK_COL_WIDTH = 280;
            renderGanttChart();
            updateZoomDisplay();
        }

        function updateZoomDisplay() {
            const display = document.getElementById('zoomDisplay');
            if (display) {
                const ratio = Math.round((DAY_WIDTH / 30) * 100);
                display.textContent = `${ratio}%`;
            }
        }


        // „Ç´„É¨„É≥„ÉÄ„ÉºÊèèÁîª
        function renderCalendar() {
            const container = document.getElementById('calendarGrid');
            const header = document.getElementById('currentMonthYear');
            const store = getCurrentStore();
            const tasks = store.tasks;

            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth(); // 0-11
            
            header.textContent = `${year}Âπ¥ ${month + 1}Êúà`;

            // 1Êó•„ÅÆÊõúÊó• (0:Êó•, 6:Âúü)
            const firstDayOfMonth = new Date(year, month, 1);
            const startDay = firstDayOfMonth.getDay();
            
            // Êúà„ÅÆÊó•Êï∞
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let html = '';

            // ÊõúÊó•„ÅÆË°®Á§∫
            const weekDays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            weekDays.forEach(day => {
                html += `<div style="font-weight: 700; text-align: center; color: var(--text-secondary); padding: 8px 0; border-bottom: 2px solid var(--border);">${day}</div>`;
            });

            // ÂÖàÊúà„ÅÆÊú´Â∞æ
            const previousMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${previousMonthLastDay - i}</div></div>`;
            }

            // ‰ªäÊúà„ÅÆÊó•‰ªò
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === new Date().toDateString();

                // „Åù„ÅÆÊó•„ÅÆ„Çø„Çπ„ÇØ„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                const dayTasks = tasks.filter(task => {
                    const start = new Date(task.startDate);
                    const end = new Date(task.endDate);
                    
                    // Êó•‰ªò„Çí„ÄåÊó•„Äç„ÅßÊØîËºÉ„Åô„Çã„Åü„ÇÅ„Å´Ê≠£Ë¶èÂåñ
                    const normalizeDate = (d) => new Date(d.getFullYear(), d.getMonth(), d.getDate());

                    return normalizeDate(date) >= normalizeDate(start) && normalizeDate(date) <= normalizeDate(end);
                });

                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}">
                        <div class="calendar-day-number">${day}</div>
                        ${dayTasks.slice(0, 3).map(task => `<div class="calendar-task" style="background: ${task.status === 'completed' ? 'var(--success)' : task.status === 'in-progress' ? 'var(--warning)' : 'var(--primary)'};">${task.taskName}</div>` ).join('')}
                        ${dayTasks.length > 3 ? `<div style="font-size: 11px; color: var(--text-secondary); padding: 2px;">+${dayTasks.length - 3}‰ª∂</div>` : ''}
                    </div>
                `;
            }

            // Ê¨°Êúà„ÅÆÊó•‰ªò
            const remainingDays = 42 - (startDay + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
            }

            container.innerHTML = html;
        }

        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function todayMonth() {
            currentMonth = new Date();
            renderCalendar();
        }


        // „Çπ„Çø„ÉÉ„Éï„É™„Çπ„ÉàÊèèÁîª
        function renderStaffList() {
            const container = document.getElementById('staffList');
            const store = getCurrentStore();
            const staff = store.staff;

            if (staff.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><div class="empty-state-text">„Çπ„Çø„ÉÉ„Éï„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div></div>';
                return;
            }

            container.innerHTML = staff.map(s => `
                <div class="staff-card">
                    <div class="staff-name">${s.name}</div>
                    <div class="staff-role">${s.role || 'ÂΩπÂâ≤Êú™ÂÆö'} (${s.position || 'ÂΩπËÅ∑„Å™„Åó'})</div>
                    <div class="staff-info-item">
                        <span class="icon">üìû</span> ${s.phone || 'N/A'}
                    </div>
                    <div class="staff-info-item">
                        <span class="icon">üìß</span> ${s.email || 'N/A'}
                    </div>
                    ${s.joinDate ? `<div class="staff-info-item">
                        <span class="icon">üóìÔ∏è</span> ÂÖ•Á§æÊó•: ${s.joinDate}
                    </div>` : ''}
                    ${s.note ? `<div class="staff-note">„É°„É¢: ${s.note}</div>` : ''}
                    <div class="btn-group" style="margin-top: 16px;">
                        <button class="btn btn-secondary" onclick="editStaff(${s.id})">Á∑®ÈõÜ</button>
                        <button class="btn btn-danger" onclick="deleteStaff(${s.id})">ÂâäÈô§</button>
                    </div>
                </div>
            `).join('');
        }

        // „Çø„Ç§„É†„É©„Ç§„É≥ÊèèÁîª
        function renderTimeline() {
            const container = document.getElementById('timelineView');
            const store = getCurrentStore();
            const tasks = store.tasks;

            if (tasks.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚è±Ô∏è</div><div class="empty-state-text">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>';
                return;
            }

            // Level-1„Åæ„Åü„ÅØLevel-2„ÅÆ‰∏ªË¶Å„Çø„Çπ„ÇØ„Å´Áµû„Çä„ÄÅÊó•‰ªòÈ†Ü„Å´„ÇΩ„Éº„Éà
            const importantTasks = tasks
                .filter(t => t.level <= 2 && t.startDate)
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));

            if (importantTasks.length === 0) {
                 container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚è±Ô∏è</div><div class="empty-state-text">Level 1/2„ÅÆ‰∏ªË¶Å„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>';
                 return;
            }

            container.innerHTML = importantTasks.map(t => `
                <div class="timeline-item">
                    <div class="timeline-dot" style="background: ${t.status === 'completed' ? 'var(--success)' : t.status === 'in-progress' ? 'var(--warning)' : 'var(--primary)'};"></div>
                    <div class="timeline-date">${t.startDate}</div>
                    <div class="timeline-content" style="border-left-color: ${t.status === 'completed' ? 'var(--success)' : t.status === 'in-progress' ? 'var(--warning)' : 'var(--primary)'};">
                        <div class="timeline-title">${t.taskName}</div>
                        <div class="timeline-meta">
                            ÊãÖÂΩì: ${t.assignee || 'Êú™ÂÆö'} | ${t.status === 'pending' ? 'Êú™ÁùÄÊâã' : t.status === 'in-progress' ? 'ÈÄ≤Ë°å‰∏≠' : 'ÂÆå‰∫Ü'}
                        </div>
                        <p style="font-size: 14px; margin-top: 8px;">${t.memo || '„É°„É¢„Å™„Åó'}</p>
                    </div>
                </div>
            `).join('');
        }

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÁµ±Ë®à
        function renderDashboard() {
            const store = getCurrentStore();
            const tasks = store.tasks;

            if (tasks.length === 0) {
                document.getElementById('totalTasks').textContent = '0';
                document.getElementById('completedTasks').textContent = '0';
                document.getElementById('inProgressTasks').textContent = '0';
                document.getElementById('progressPercent').textContent = '0%';
                document.getElementById('dashboardStats').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><div class="empty-state-text">„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>';
                return;
            }

            const total = tasks.length;
            const completed = tasks.filter(t => t.status === 'completed').length;
            const inProgress = tasks.filter(t => t.status === 'in-progress').length;
            const notStarted = tasks.filter(t => t.status === 'pending').length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('inProgressTasks').textContent = inProgress;
            document.getElementById('progressPercent').textContent = progress + '%';

            // „É¨„Éô„É´Âà•ÈõÜË®à
            const byLevel = {};
            tasks.forEach(task => {
                byLevel[task.level] = (byLevel[task.level] || { total: 0, completed: 0 });
                byLevel[task.level].total++;
                if (task.status === 'completed') {
                    byLevel[task.level].completed++;
                }
            });

            let levelStatsHTML = '<h3>„É¨„Éô„É´Âà•ÈÄ≤Êçó</h3><ul style="list-style: none; padding: 0;">';
            Object.keys(byLevel).sort().forEach(level => {
                const data = byLevel[level];
                const levelProgress = data.total > 0 ? Math.round((data.completed / data.total) * 100) : 0;
                levelStatsHTML += `
                    <li style="margin-bottom: 10px; font-size: 15px;">
                        <span style="font-weight: 600;">Level ${level}</span> (${data.completed}/${data.total} ÂÆå‰∫Ü)
                        <div style="height: 8px; background: var(--background); border-radius: 4px; margin-top: 4px;">
                            <div style="width: ${levelProgress}%; height: 100%; background: var(--success); border-radius: 4px; transition: width 0.5s ease;"></div>
                        </div>
                    </li>
                `;
            });
            levelStatsHTML += '</ul>';

            // ÊãÖÂΩìËÄÖÂà•ÈõÜË®à
            const byAssignee = {};
            tasks.forEach(task => {
                const assignees = task.assignee.split(/[/„Éª]/).map(a => a.trim()).filter(a => a);
                assignees.forEach(assignee => {
                    byAssignee[assignee] = (byAssignee[assignee] || { total: 0, completed: 0 });
                    byAssignee[assignee].total++;
                    if (task.status === 'completed') {
                        byAssignee[assignee].completed++;
                    }
                });
            });

            let assigneeStatsHTML = '<h3>ÊãÖÂΩìËÄÖÂà•ÈÄ≤Êçó</h3><ul style="list-style: none; padding: 0;">';
            Object.keys(byAssignee).sort().forEach(assignee => {
                const data = byAssignee[assignee];
                const assigneeProgress = data.total > 0 ? Math.round((data.completed / data.total) * 100) : 0;
                assigneeStatsHTML += `
                    <li style="margin-bottom: 10px; font-size: 15px;">
                        <span style="font-weight: 600;">${assignee}</span> (${data.completed}/${data.total} ÂÆå‰∫Ü)
                        <div style="height: 8px; background: var(--background); border-radius: 4px; margin-top: 4px;">
                            <div style="width: ${assigneeProgress}%; height: 100%; background: var(--primary); border-radius: 4px; transition: width 0.5s ease;"></div>
                        </div>
                    </li>
                `;
            });
            assigneeStatsHTML += '</ul>';


            document.getElementById('dashboardStats').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h3>„Çπ„ÉÜ„Éº„Çø„ÇπÂà•</h3>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <div style="flex: 1; text-align: center; padding: 10px; background: #E8F5E9; border-radius: 8px; color: #388E3C;">
                                <strong>ÂÆå‰∫Ü:</strong> ${completed}
                            </div>
                            <div style="flex: 1; text-align: center; padding: 10px; background: #E3F2FD; border-radius: 8px; color: #1976D2;">
                                <strong>ÈÄ≤Ë°å‰∏≠:</strong> ${inProgress}
                            </div>
                            <div style="flex: 1; text-align: center; padding: 10px; background: #FEF5E7; border-radius: 8px; color: #D68910;">
                                <strong>Êú™ÁùÄÊâã:</strong> ${notStarted}
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            ${levelStatsHTML}
                        </div>
                    </div>
                    
                    <div style="overflow-y: auto; max-height: 400px; padding-right: 10px;">
                        ${assigneeStatsHTML}
                    </div>
                </div>
            `;
            
            // ÂÆå‰∫ÜÁéá100%„Å™„ÇâÁ¥ôÂêπÈõ™
            if (progress === 100) {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }
        }


        // -------------------------------------------------------------------------
        // 8. „Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜÈñ¢Êï∞
        // -------------------------------------------------------------------------

        let editingStaffId = null;

        function openStaffModal(staffId = null) {
            const modal = document.getElementById('staffModal');
            const form = document.getElementById('staffForm');
            const title = document.getElementById('staffModalTitle');
            const submitBtn = document.getElementById('staffSubmitBtn');
            form.reset();
            
            editingStaffId = staffId;

            if (staffId) {
                const staff = getStaffById(staffId);
                if (staff) {
                    title.textContent = '„Çπ„Çø„ÉÉ„ÉïÁ∑®ÈõÜ';
                    submitBtn.textContent = 'Êõ¥Êñ∞';
                    document.getElementById('staffIdToEdit').value = staff.id;
                    document.getElementById('staffName').value = staff.name;
                    document.getElementById('staffRole').value = staff.role;
                    document.getElementById('staffPosition').value = staff.position;
                    document.getElementById('staffNote').value = staff.note;
                    document.getElementById('staffPhone').value = staff.phone;
                    document.getElementById('staffEmail').value = staff.email;
                    document.getElementById('staffJoinDate').value = staff.joinDate;
                }
            } else {
                title.textContent = '„Çπ„Çø„ÉÉ„ÉïËøΩÂä†';
                submitBtn.textContent = 'ËøΩÂä†';
                document.getElementById('staffIdToEdit').value = '';
            }

            modal.style.display = 'block';
        }

        function closeStaffModal() {
            document.getElementById('staffModal').style.display = 'none';
            editingStaffId = null;
        }

        function addOrUpdateStaff(event) {
            event.preventDefault();
            const store = getCurrentStore();
            
            const staffData = {
                name: document.getElementById('staffName').value.trim(),
                role: document.getElementById('staffRole').value.trim(),
                position: document.getElementById('staffPosition').value.trim(),
                note: document.getElementById('staffNote').value.trim(),
                phone: document.getElementById('staffPhone').value.trim(),
                email: document.getElementById('staffEmail').value.trim(),
                joinDate: document.getElementById('staffJoinDate').value,
            };

            if (editingStaffId !== null) {
                // Êõ¥Êñ∞Âá¶ÁêÜ
                const staff = store.staff.find(s => s.id === editingStaffId);
                if (staff) {
                    Object.assign(staff, staffData);
                    alert(`‚úÖ „Çπ„Çø„ÉÉ„Éï„Äå${staff.name}„Äç„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü„ÄÇ`);
                }
            } else {
                // Êñ∞Ë¶èËøΩÂä†Âá¶ÁêÜ
                const newStaff = {
                    id: staffIdCounter++,
                    ...staffData
                };
                store.staff.push(newStaff);
                alert(`‚úÖ „Çπ„Çø„ÉÉ„Éï„Äå${newStaff.name}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ`);
            }
            
            saveData();
            renderStaffList();
            closeStaffModal();
        }

        function editStaff(staffId) {
            openStaffModal(staffId);
        }

        function deleteStaff(staffId) {
            if (!confirm('„Åì„ÅÆ„Çπ„Çø„ÉÉ„Éï„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            const store = getCurrentStore();
            store.staff = store.staff.filter(s => s.id !== staffId);

            saveData();
            renderStaffList();
            alert('‚úÖ „Çπ„Çø„ÉÉ„Éï„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ');
        }


        // -------------------------------------------------------------------------
        // 9. „É¶„Éº„Ç∂„ÉºË™çË®º„ÉªË®≠ÂÆöÈñ¢Êï∞
        // -------------------------------------------------------------------------

        // „É¶„Éº„Ç∂„Éº„É™„Çπ„ÉàÊèèÁîª (Ë®≠ÂÆöÁîªÈù¢Áî®)
        function renderUserList() {
            const container = document.getElementById('userList');
            if (!container) return;
            
            if (currentUser && currentUser.role !== 'admin') {
                container.innerHTML = '<p style="color: var(--danger); font-weight: 600;">„Åì„ÅÆÊ©üËÉΩ„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÂà©Áî®ÂèØËÉΩ„Åß„Åô„ÄÇ</p>';
                return;
            }

            let html = '';
            users.forEach(user => {
                // „É≠„Ç∞„Ç§„É≥‰∏≠„ÅÆËá™ÂàÜËá™Ë∫´„ÅØÂâäÈô§„Åß„Åç„Å™„ÅÑ„Çà„ÅÜ„Å´„Çπ„Ç≠„ÉÉ„Éó
                if (currentUser && user.id === currentUser.id) return;
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">${user.name}</div>
                            <div style="font-size: 14px; color: #86868B;">${user.email}</div>
                            <span style="display: inline-block; padding: 4px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; margin-top: 8px; ${user.role === 'admin' ? 'background: rgba(0, 122, 255, 0.1); color: #007AFF;' : 'background: rgba(88, 86, 214, 0.1); color: #5856D6;'}">${user.role === 'admin' ? 'ÁÆ°ÁêÜËÄÖ' : 'Á∑®ÈõÜËÄÖ'}</span>
                        </div>
                        <button class="btn btn-danger" onclick="deleteUser(${user.id})">ÂâäÈô§</button>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function openUserModal() {
            if (currentUser.role !== 'admin') return;
            document.getElementById('userModal').style.display = 'block';
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            document.getElementById('userForm').reset();
        }
        
        function addUser(event) {
            event.preventDefault();
            if (currentUser.role !== 'admin') return;

            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value;
            const role = document.getElementById('userRole').value;

            if (users.find(u => u.email === email)) {
                alert('„Åì„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                return;
            }
            
            const newUser = {
                id: userIdCounter++,
                name: name,
                email: email,
                password: password,
                role: role
            };
            
            users.push(newUser);
            localStorage.setItem('istyle_users', JSON.stringify(users));
            renderUserList();
            closeUserModal();
            alert(`‚úÖ „É¶„Éº„Ç∂„Éº„Äå${name}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ`);
        }

        // „É¶„Éº„Ç∂„ÉºÂâäÈô§
        function deleteUser(userId) {
            if (currentUser.role !== 'admin') return;
            
            if (!confirm('„Åì„ÅÆ„É¶„Éº„Ç∂„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            users = users.filter(u => u.id !== userId);
            localStorage.setItem('istyle_users', JSON.stringify(users));
            renderUserList();
        }
        
        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('istyle_currentUser', JSON.stringify(user));
                showApp();
            } else {
                const errorDiv = document.getElementById('loginError');
                errorDiv.textContent = '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì';
                errorDiv.style.display = 'block';
            }
        }
        
        // „É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ
        function logout() {
            currentUser = null;
            localStorage.removeItem('istyle_currentUser');
            showLogin();
        }

        // „É≠„Ç∞„Ç§„É≥„ÉÅ„Çß„ÉÉ„ÇØ
        function checkLogin() {
            const savedUser = localStorage.getItem('istyle_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showLogin();
            }
        }
        
        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Ë°®Á§∫
        function showApp() {
            document.getElementById('login').style.display = 'none';
            document.querySelector('.app-container').style.display = 'flex';
            
            // „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë°®Á§∫
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserRole').textContent = currentUser.role === 'admin' ? 'ÁÆ°ÁêÜËÄÖ' : 'Á∑®ÈõÜËÄÖ';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';

            // ÂàùÊúü„É¨„É≥„ÉÄ„É™„É≥„Ç∞
            renderAll();
            showTab('dashboard');
        }

        // „É≠„Ç∞„Ç§„É≥ÁîªÈù¢Ë°®Á§∫
        function showLogin() {
            document.querySelector('.app-container').style.display = 'none';
            document.getElementById('login').style.display = 'flex';
        }

        // -------------------------------------------------------------------------
        // 10. ÂÖ®‰ΩìÂà∂Âæ°Èñ¢Êï∞
        // -------------------------------------------------------------------------

        // ÂÖ®„Å¶„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderAll() {
            renderDashboard();
            renderTaskList();
            renderGanttChart();
            renderCalendar();
            renderStaffList();
            renderTimeline();
        }

        // ÂÖ®„Éá„Éº„ÇøÂâäÈô§
        function clearAllData() {
            if (currentUser.role !== 'admin') {
                 alert('ÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÂÖ®„Éá„Éº„Çø„ÇíÂâäÈô§„Åß„Åç„Åæ„Åô„ÄÇ');
                 return;
            }
            if (confirm('Êú¨ÂΩì„Å´ÂÖ®„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                // ÂàùÊúü„Éá„Éº„Çø„Åß‰∏äÊõ∏„Åç
                stores = {
                    'default': { name: '„Éá„Éï„Ç©„É´„ÉàÂ∫óËàó', tasks: [], staff: [] },
                    'store_1700000000000': { 
                        name: '„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó', 
                        tasks: [
                            // ÂàùÊúü„Çø„Çπ„ÇØ„É™„Çπ„Éà„ÇíÂÜçÂÆöÁæ© (Á∞°Áï•Âåñ„ÅÆ„Åü„ÇÅ„Å´Á©∫„Åæ„Åü„ÅØÊúÄÂ∞èÈôê„ÅÆ„Çø„Çπ„ÇØ„Å´Êàª„Åô„Åì„Å®„ÇÇÊ§úË®é)
                             { id: 1, level: 1, parentTaskName: "", taskName: "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà", assignee: "Á´π‰πãÂÜÖ/ÁßãÂ±±", memo: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂÖ®‰Ωì„ÅÆË¶™„Çø„Çπ„ÇØ", startDate: "2025-06-01", endDate: "2025-11-30", status: "in-progress" },
                             { id: 2, level: 2, parentTaskName: "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà", taskName: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠Ë®à„ÉªÂÖ®‰ΩìË®àÁîª", assignee: "ÁßãÂ±±", memo: "ÂÖ®‰ΩìÂÉè„ÇíÂõ∫„ÇÅ„Çã„Éï„Çß„Éº„Ç∫", startDate: "2025-06-01", endDate: "2025-06-30", status: "in-progress" },
                             { id: 3, level: 3, parentTaskName: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠Ë®à„ÉªÂÖ®‰ΩìË®àÁîª", taskName: "Â£≤‰∏ä„ÉªÂÆ¢Êï∞„ÉªÂÆ¢Âçò‰æ°„Å™„Å©KGI/KPI„ÇíË®≠ÂÆö„Åô„Çã", assignee: "ÁßãÂ±±", memo: "1„É∂Êúà/3„É∂Êúà/1Âπ¥„ÅÆÁõÆÊ®ô", startDate: "2025-06-01", endDate: "2025-06-15", status: "completed" },
                             { id: 4, level: 3, parentTaskName: "„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠Ë®à„ÉªÂÖ®‰ΩìË®àÁîª", taskName: "„Éû„Çπ„Çø„Éº„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºà„Ç¨„É≥„Éà„ÉÅ„É£„Éº„ÉàÔºâ„Çí‰ΩúÊàê„Åô„Çã", assignee: "ÁßãÂ±±", memo: "Êú¨„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´ÂèçÊò†", startDate: "2025-06-15", endDate: "2025-06-30", status: "in-progress" },
                             { id: 5, level: 2, parentTaskName: "„É©„Çæ„Éº„ÉäÂ∑ùÂ¥éÂ∫ó„Ç™„Éº„Éó„É≥„Éó„É≠„Ç∏„Çß„ÇØ„Éà", taskName: "„Éá„Éô„É≠„ÉÉ„Éë„Éº„ÉªÂ•ëÁ¥ÑÈñ¢ÈÄ£", assignee: "Á´π‰πãÂÜÖ", memo: "„Éá„Éô„É≠„ÉÉ„Éë„Éº„Å®„ÅÆÁ™ìÂè£", startDate: "2025-06-01", endDate: "2025-08-31", status: "completed" }
                        ],
                        staff: [
                             { id: 1, name: 'Á´π‰πãÂÜÖ', role: '„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË≤¨‰ªªËÄÖ', position: 'ÈÉ®Èï∑', phone: '090-xxxx-xxxx', email: 'takenouchi@istyle.co.jp', joinDate: '2015-04-01', note: '„Éá„Éô„É≠„ÉÉ„Éë„Éº„ÉªË®≠Ë®àÁ™ìÂè£' },
                             { id: 2, name: 'ÁßãÂ±±', role: 'Â∫óËàóÈñãÁô∫Ë≤¨‰ªªËÄÖ', position: '„Éû„Éç„Éº„Ç∏„É£„Éº', phone: '080-xxxx-xxxx', email: 'akiyama@istyle.co.jp', joinDate: '2018-06-15', note: 'Êé°Áî®„ÉªÂÖ®‰ΩìË®àÁîªÁ™ìÂè£' }
                        ]
                    }
                };
                currentStore = 'store_1700000000000';
                
                users = [
                    { id: 1, name: 'ÁÆ°ÁêÜËÄÖA', email: 'admin@istyle.co.jp', password: 'password', role: 'admin' },
                    { id: 2, name: 'Á∑®ÈõÜËÄÖB', email: 'editor@istyle.co.jp', password: 'password', role: 'editor' }
                ];

                taskIdCounter = 6;
                staffIdCounter = 3;
                userIdCounter = 3;
                
                saveData();
                localStorage.setItem('istyle_users', JSON.stringify(users));
                initializeStoreSelector();
                renderAll();
                alert('‚úÖ ÂÖ®„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„ÄÅÂàùÊúüÁä∂ÊÖã„Å´Êàª„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        }


        // „É™„Çµ„Ç§„Ç∂„ÉºÊ©üËÉΩ („Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà„ÅÆ„Çø„Çπ„ÇØÂêçÂàóÂπÖË™øÊï¥Áî®)
        function setupResizers() {
            const sidebar = document.querySelector('.sidebar');
            const sidebarResizer = document.getElementById('sidebarResizer');
            const contentHeader = document.querySelector('.content-header');
            const headerResizer = document.getElementById('headerResizer');
            let isResizingSidebar = false;
            let isResizingHeader = false;
            let startX = 0;
            let startY = 0;
            let startWidth = 0;
            let startHeight = 0;
            
            // „Çµ„Ç§„Éâ„Éê„Éº„É™„Çµ„Ç§„Ç∂„Éº
            if (sidebarResizer) {
                sidebarResizer.addEventListener('mousedown', (e) => {
                    if (window.innerWidth <= 768) return; // „É¢„Éê„Ç§„É´„Åß„ÅØÁÑ°ÂäπÂåñ
                    isResizingSidebar = true;
                    startX = e.clientX;
                    startWidth = parseInt(getComputedStyle(sidebar).width, 10);
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';
                    e.preventDefault();
                });
            }

            // „Éò„ÉÉ„ÉÄ„Éº„É™„Çµ„Ç§„Ç∂„Éº
            if (headerResizer) {
                headerResizer.addEventListener('mousedown', (e) => {
                    isResizingHeader = true;
                    startY = e.clientY;
                    startHeight = contentHeader.offsetHeight;
                    document.body.style.cursor = 'ns-resize';
                    document.body.style.userSelect = 'none';
                    e.preventDefault();
                });
            }

            // „Éû„Ç¶„ÇπÁßªÂãï
            document.addEventListener('mousemove', (e) => {
                if (isResizingSidebar) {
                    const width = startWidth + (e.clientX - startX);
                    if (width >= 200 && width <= 500) {
                        sidebar.style.width = width + 'px';
                        TASK_COL_WIDTH = width; // „Ç¨„É≥„Éà„ÉÅ„É£„Éº„Éà„ÅÆ„Çø„Çπ„ÇØÂêçÂàóÂπÖ„Å®ÈÄ£Âãï
                        renderGanttChart();
                    }
                } else if (isResizingHeader) {
                    const height = startHeight + (e.clientY - startY);
                    if (height >= 50 && height <= 150) {
                        // „Éë„Éá„Ç£„É≥„Ç∞„ÇíË™øÊï¥„Åó„Å¶È´ò„Åï„ÇíÂ§â„Åà„Çã
                        const topBottomPadding = (height - 50) / 2;
                        contentHeader.style.padding = Math.max(12, topBottomPadding + 12) + 'px 24px ' + Math.max(12, topBottomPadding + 12) + 'px 24px';
                    }
                }
            });

            // „Éû„Ç¶„Çπ„Ç¢„ÉÉ„Éó
            document.addEventListener('mouseup', () => {
                isResizingSidebar = false;
                isResizingHeader = false;
                document.body.style.cursor = 'default';
                document.body.style.userSelect = 'auto';
            });
        }


        // ÂàùÊúüÂá¶ÁêÜ
        window.onload = function() {
            loadData();
            initializeStoreSelector();
            setupFileImport();
            setupResizers();
            checkLogin();
        };

    </script>
</body>
</html>